<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta name="description" content="庆归的博客，主要用来记笔记，分享心得">
<meta property="og:type" content="website">
<meta property="og:title" content="庆归的博客">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="庆归的博客">
<meta property="og:description" content="庆归的博客，主要用来记笔记，分享心得">
<meta property="og:locale" content="zh">
<meta property="article:author" content="Qinggui">
<meta property="article:tag" content="学习笔记，读书笔记，心得">
<meta name="twitter:card" content="summary">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/"/>





  <title>庆归的博客</title>
  








<meta name="generator" content="Hexo 4.2.1"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">庆归的博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/%20" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/06/29/spider/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Qinggui">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="庆归的博客">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2020/06/29/spider/" itemprop="url">spider</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2020-06-29T16:23:41+08:00">
                2020-06-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Pyqthon3-网络爬虫开发实战"><a href="#Pyqthon3-网络爬虫开发实战" class="headerlink" title="Pyqthon3 网络爬虫开发实战"></a>Pyqthon3 网络爬虫开发实战</h2><h2 id="http-httpbin-org-get-测试网址"><a href="#http-httpbin-org-get-测试网址" class="headerlink" title="http://httpbin.org/get 测试网址"></a><a href="http://httpbin.org/get" target="_blank" rel="noopener">http://httpbin.org/get</a> 测试网址</h2><p><strong><a href="https://jd.com:443" target="_blank" rel="noopener">https://jd.com:443</a></strong>  同源策略：协议，域名，端口 只要一个不同，就会出现跨域</p>
<h4 id="HTTP特点"><a href="#HTTP特点" class="headerlink" title="HTTP特点"></a>HTTP特点</h4><p><strong>应用层 在TCP上</strong>  ==<strong>无连接，1.1以后是长连接Keep-Alive</strong> ，<strong>无状态</strong>==  <strong>80</strong></p>
<p>无连接：连接一个就会断开，不会一直保持</p>
<p>无状态：服务器不会记住谁和它连接了。能记住是因为用了其它手段（如session），并不是http做到的。</p>
<p>https 443 也是无连接无状态，没有记忆</p>
<h4 id="HTTP报文"><a href="#HTTP报文" class="headerlink" title="HTTP报文"></a>HTTP报文</h4><h5 id="请求报文："><a href="#请求报文：" class="headerlink" title="请求报文："></a>请求报文：</h5><ul>
<li><p><strong>请求行：</strong></p>
<p> 请求的方法（head,put,delete..），URL，协议版本</p>
</li>
<li><p><strong>请求头</strong>：类型，长度，编码，主机等等</p>
</li>
<li><p><strong>空行</strong>：遇到空行，表示后面con的就是请求体</p>
</li>
<li><p><strong>请求体：</strong>数据部分</p>
</li>
</ul>
<h5 id="响应报文："><a href="#响应报文：" class="headerlink" title="响应报文："></a>响应报文：</h5><ul>
<li><strong>响应状态行</strong>：版本，状态码</li>
<li><strong>响应头</strong></li>
<li><strong>空行</strong></li>
<li><strong>响应体</strong></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">常见响应状态码：</span><br><span class="line">301：永久重定向，一万年</span><br><span class="line">302：临时移到别处去了</span><br><span class="line">404：未找到</span><br><span class="line">50x:服务器问题</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get 和 post 区别：</span><br><span class="line">1.get携带参数都在url中，post已表单方式提交，安全。。账号密码用post</span><br><span class="line">2.get最大提交1024字节，post无限制。。大文件用post</span><br><span class="line">3.get不会重新请求，post会</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cookies在客户端，session在服务器端。</span><br><span class="line">cookie进行判别身份，进行会话跟踪存储在本地</span><br><span class="line">有了cookies.浏览器再下次访问的时候会携带cookies发给服务器。</span><br><span class="line">cookies维持当前会话，状态，发给服务器确认。通过cookies识别是我自己</span><br><span class="line">set-cookie:告诉浏览器要设置cookie，下次请求要带</span><br><span class="line">expires:设置过期时间，降低缓存，减少加载时间</span><br><span class="line">长连接&#x2F;持久连接：Connection:keep-alive</span><br></pre></td></tr></table></figure>

<p><strong>Referer：常用来做防盗链、来源统计，标识请求从哪个页面过发来的</strong></p>
<blockquote>
<p>浏览器向网站所在的服务器发送请求，服务器收到请求后进行处理解析，返回给浏览器</p>
<p>详细：</p>
<p>1.浏览器通过DNS服务器找到域名对应的IP地址；</p>
<p>2.向IP地址对应的web服务器发起请求；</p>
<p>3.服务器收到请求，返回响应HTML数据；</p>
<p>4.浏览器解析HTMl数据展示给用户</p>
</blockquote>
<p>==结构==  ==表现==  ==行为==     <strong>‘X-Forwarded-For’:”-“</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">css 不加空格表并列，加空格表示后代</span><br><span class="line">div,p 选择div和p</span><br><span class="line">div p div后面的所有的p</span><br><span class="line">div&gt;p div后面亲儿子是p的</span><br><span class="line">div+p 和div是兄弟的p</span><br><span class="line"></span><br><span class="line">pattern &#x3D; re.compile(r&quot;[\u4e00-\u9fa5]+&quot;) #*只匹配中文</span><br><span class="line">result &#x3D; pattern.findall(title)</span><br></pre></td></tr></table></figure>

<h4 id="爬虫流程"><a href="#爬虫流程" class="headerlink" title="爬虫流程"></a>爬虫流程</h4><ul>
<li>发起请求</li>
<li>获取响应数据</li>
<li>解析内容</li>
<li>持久化</li>
</ul>
<h4 id="爬虫分类"><a href="#爬虫分类" class="headerlink" title="爬虫分类"></a>爬虫分类</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">通用爬虫</span><br><span class="line">聚焦爬虫</span><br><span class="line">增量式爬虫</span><br><span class="line"></span><br><span class="line">爬虫的搜索策略：</span><br><span class="line">    深度优先</span><br><span class="line">    广度优先（爬虫）</span><br></pre></td></tr></table></figure>

<h4 id="urllib库"><a href="#urllib库" class="headerlink" title="urllib库"></a>urllib库</h4><ul>
<li><strong>request</strong>     <strong>==request.urlretrieve(网址,存储路径)==</strong></li>
<li><strong>error</strong></li>
<li><strong>parse</strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request</span><br><span class="line">response= request.urlopen(<span class="string">'https://www.python.org'</span>)</span><br><span class="line">print(response.read().decode (<span class="string">'utf-8'</span>))</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.status</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>response.getheaders() <span class="comment">#得到头部信息</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> urllib.parse</span><br><span class="line"><span class="comment">#如果要传data数据就要转成字节，变成POST请求了</span></span><br><span class="line"><span class="comment">#urlencode()里面是一个字典，转成网址能理解的字符</span></span><br><span class="line">data = bytes(urllib.parse.urlencode(&#123;<span class="string">'word’:’ hello'</span>&#125;),encoding＝<span class="string">'utf-8'</span>)</span><br><span class="line">response= urllib.request.urlopen(<span class="string">'http://bin.org/post'</span>, data=data) <span class="comment">#data必须要是字节类型</span></span><br><span class="line">print(response.read())</span><br><span class="line"></span><br><span class="line"><span class="comment">#设置代理---》写进去---》用open打开</span></span><br><span class="line">url = <span class="string">'xxx'</span></span><br><span class="line">proxy_handler = urllib.request.ProxyHandler(&#123;<span class="string">'http'</span>:<span class="number">192.</span>xx,<span class="string">'https'</span>:xx&#125;)</span><br><span class="line">opener = urllib.request.bulid_opener(proxy_handler)</span><br><span class="line">response = opener.open(url)</span><br><span class="line">html = response.read()</span><br><span class="line"><span class="comment">#先建Mozilla对象</span></span><br><span class="line"><span class="keyword">from</span> http <span class="keyword">import</span> cookiejar</span><br><span class="line">filename = <span class="string">'cookie.txt'</span></span><br><span class="line">cookie = cookiejar.MozillaCookieJar(filename)</span><br><span class="line"></span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">opener.open(url)</span><br><span class="line">cookie.save() <span class="comment">#保存cookie</span></span><br><span class="line"><span class="comment">#读取</span></span><br><span class="line">cookie = cookiejar.MozillaCookieJar()</span><br><span class="line">cookie.load(filename)</span><br><span class="line">handler = urllib.request.HTTPCookieProcessor(cookie)</span><br><span class="line">opener = urllib.request.build_opener(handler)</span><br><span class="line">opener.open(url)</span><br><span class="line">print(cookie)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#URLError</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> error</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	response = request.urlopen(<span class="string">"http://httpbin.org/post"</span>,timeout=<span class="number">0.1</span>)</span><br><span class="line"> <span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">if</span> isinstance(e.reason,socket.timeout):</span><br><span class="line">        print(<span class="string">"TIME OUT"</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">headers = &#123;<span class="string">"User-Agent"</span>:<span class="string">'xx'</span>&#125;</span><br><span class="line">dict_demo = &#123;<span class="string">'name'</span>:<span class="string">"gui"</span>&#125;   <span class="comment">#要明白urlencode()转化为name=gui这样的形式了</span></span><br><span class="line">data = bytes(urllib.parse.urlencode(dict_demo).encode())</span><br><span class="line">req = request.Request(<span class="string">"https://www.baidu.com"</span>,data=data,headers=headers) <span class="comment">#data必须是字节</span></span><br><span class="line">req.add_header(<span class="string">"Connection"</span>,<span class="string">"keep-alive"</span>) <span class="comment">#你还有用#add_header()也可以添加头部</span></span><br><span class="line">response = request.urlopen(req)</span><br><span class="line">print(response.read().decode(<span class="string">"utf-8"</span>))</span><br><span class="line"></span><br><span class="line">req = request.Request(url=url,headers= &#123;xx&#125; data=data, method=<span class="string">'POST’)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''标准写法，最后写URLError'''</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> request, error</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	response = request.urlopen(<span class="string">'https://cuiqingcai.com/'</span>)</span><br><span class="line"><span class="keyword">except</span> error.HTTPError <span class="keyword">as</span> e:</span><br><span class="line">	print(e.reason, e.code, e.headers, sep=’\n’)</span><br><span class="line"><span class="keyword">except</span> error.URLError <span class="keyword">as</span> e:</span><br><span class="line">	print(e.reason)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'Request Successfully'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""urlparse将网址分解成很多段，用索引可直接提出来，也就是一个网址的组成部分：协议：//路径"""</span></span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">parse.urlparse(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>ParseResult(scheme=<span class="string">'https'</span>, netloc=<span class="string">'www.baidu.com'</span>, path=<span class="string">''</span>, params=<span class="string">''</span>, query=<span class="string">''</span>, fragment=<span class="string">''</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li>urlsplit()</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">和urlparse 基本一样</span><br></pre></td></tr></table></figure>

<ul>
<li>urljoin()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#拼接,合并</span></span><br><span class="line">parse.urljoin(<span class="string">'http://www .baidu.com '</span>, <span class="string">'https://cuiqingcai .com/FAQ .html'</span>))</span><br><span class="line"><span class="string">'''如果前后都一样，则只输出后面的部分'''</span></span><br></pre></td></tr></table></figure>

<ul>
<li>urlencode()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""通过urlencode解析字典成网址能理解的参数"""</span></span><br><span class="line">params = &#123;</span><br><span class="line"><span class="string">'name'</span> :<span class="string">'germey'</span> ,</span><br><span class="line"><span class="string">'age'</span> : <span class="number">22</span>&#125;</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">params = parse.urlencode(params) <span class="comment">#a=1 这种形式</span></span><br><span class="line">url = <span class="string">"https://www.baidu.com"</span></span><br><span class="line">new_url = url+params</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>new_url <span class="comment">#'https://www.baidu.comname=germey&amp;age=22'</span></span><br></pre></td></tr></table></figure>

<ul>
<li>quote()</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""quote把【单词】转成网址能理解的字符"""</span></span><br><span class="line">key = parse.quote(<span class="string">"壁纸"</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>key</span><br><span class="line">&gt;&gt;&gt;<span class="string">'%E5%A3%81%E7%BA%B8'</span></span><br><span class="line">url = <span class="string">"https://www.baidu.com"</span>+key</span><br><span class="line"></span><br><span class="line"><span class="string">'''unquote :把网址后面的字符转成我们能理解的中文'''</span></span><br><span class="line">parse.unquote(url) <span class="comment">#和urlencode()、quote()相反</span></span><br></pre></td></tr></table></figure>

<h4 id="requests-cache库"><a href="#requests-cache库" class="headerlink" title="requests_cache库"></a><strong>requests_cache库</strong></h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">作用：有缓存用缓存，没有缓存才请求生成，减少对服务器的反复请求，防止封号</span><br><span class="line"><span class="keyword">import</span> requests_cache,requests</span><br><span class="line"></span><br><span class="line">requests_cache.install_cache() <span class="comment">#加入这一行即可,backend后端参数存储到哪里</span></span><br><span class="line">requests_cache.clear()  <span class="comment">#清除已有的缓存</span></span><br><span class="line">session = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">2</span>):</span><br><span class="line">	response = session.get(url) <span class="comment">#连续访问两次发现只会有一个记录</span></span><br><span class="line">    print(response.from_cache) <span class="comment">#True表示生成缓存</span></span><br></pre></td></tr></table></figure>

<p><strong>requests_html</strong>      </p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests_html </span><br><span class="line">session = requests_html.HTMLSession() <span class="comment">#session会话</span></span><br><span class="line">r = session.get(url)</span><br><span class="line">r.html.render() <span class="comment">#加载ajax带上这句就行</span></span><br><span class="line">print(r.html.text)<span class="comment"># 全部文本</span></span><br><span class="line">print(r.html.links) <span class="comment"># 全部链接</span></span><br><span class="line">print(r.html.absolute_links) <span class="comment"># 完整的链接</span></span><br><span class="line">a = r.html.xpath(<span class="string">'xx'</span>)  <span class="comment">#还可以用find('css表达式')</span></span><br><span class="line">a.text</span><br></pre></td></tr></table></figure>

<h4 id="requests库"><a href="#requests库" class="headerlink" title="requests库"></a>requests库</h4><blockquote>
<p><strong>from requests.exceptions import RequestException</strong>    </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"> <span class="string">'apparent_encoding'</span>,</span><br><span class="line"> <span class="string">'close'</span>,</span><br><span class="line"> <span class="string">'connection'</span>,</span><br><span class="line"> <span class="string">'content'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'cookies'</span>, <span class="comment">###</span></span><br><span class="line"> <span class="string">'elapsed'</span>,</span><br><span class="line"> <span class="string">'encoding'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'headers'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'history'</span>,</span><br><span class="line"> <span class="string">'is_permanent_redirect'</span>,</span><br><span class="line"> <span class="string">'is_redirect'</span>,</span><br><span class="line"> <span class="string">'iter_content'</span>,</span><br><span class="line"> <span class="string">'iter_lines'</span>,</span><br><span class="line"> <span class="string">'json'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'links'</span>,</span><br><span class="line"> <span class="string">'next'</span>,</span><br><span class="line"> <span class="string">'ok'</span>,<span class="comment">##</span></span><br><span class="line"> <span class="string">'raise_for_status'</span>,</span><br><span class="line"> <span class="string">'raw'</span>,</span><br><span class="line"> <span class="string">'reason'</span>,<span class="comment">#</span></span><br><span class="line"> <span class="string">'request'</span>,</span><br><span class="line"> <span class="string">'status_code'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'text'</span>,<span class="comment">###</span></span><br><span class="line"> <span class="string">'url'</span><span class="comment">#</span></span><br><span class="line">requests.codes.ok == <span class="number">200</span> <span class="comment">#True</span></span><br><span class="line"><span class="string">'''上传文件'''</span></span><br><span class="line">files = &#123;<span class="string">"file"</span>:open(<span class="string">'x.txt'</span>,<span class="string">'rb'</span>)&#125;</span><br><span class="line">requests.post(url,files=fiels)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''证书禁止,禁止后会有警告，用下面的方式'''</span></span><br><span class="line">requests.get(<span class="string">'https://www.12306.cn'</span>,verify=<span class="literal">False</span>)</span><br><span class="line"><span class="string">"""方式一：不开启警告"""</span></span><br><span class="line"><span class="keyword">from</span> requests.packages <span class="keyword">import</span> urllib3</span><br><span class="line">urllib3.disable_warnings()   <span class="comment">#</span></span><br><span class="line"><span class="string">'''方式二：捕捉警告'''</span></span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line">logging.captureWarnings(<span class="literal">True</span>)</span><br><span class="line"><span class="string">"""方式三：上传本地证书"""</span></span><br><span class="line">requests.get(<span class="string">"www.xxx"</span>.cert=(<span class="string">'路径'</span>))</span><br><span class="line">=========================</span><br><span class="line"><span class="string">"""弹出网页身份认证窗口"""</span></span><br><span class="line">requests.get(<span class="string">"www.xx"</span>,auth=(<span class="string">'用户名'</span>,<span class="string">'密码'</span>)) <span class="comment">#元组</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>(.*?):(.*?)\n</p>
<p>“$1”:”$2”,\n</p>
</blockquote>
<h4 id="xpath"><a href="#xpath" class="headerlink" title="xpath"></a>xpath</h4><p><strong>/和//区别，一个是子结点，一个是子孙</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#html = etree.HTML(page_text)直接解析网页用HTML</span></span><br><span class="line">html = etree.parse(<span class="string">'./test. html'</span>, etree.HTMLParser()) <span class="comment">#外部的网页文件用parse</span></span><br><span class="line">result= etree.tostring(html) <span class="comment">#又转回成网页格式了</span></span><br></pre></td></tr></table></figure>

<p><strong>选取子结点</strong></p>
<p>==<strong>取属性值://li/a/@href</strong>==</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">html = etree.HTML(page_text)</span><br><span class="line">html.xpath(<span class="string">'//div/a'</span>) <span class="comment">#div下第一个a</span></span><br><span class="line"><span class="string">"""选取所有的://"""</span></span><br><span class="line">html.xpath(<span class="string">'//div//a)</span></span><br><span class="line"><span class="string">"""选取父结点:.."""</span></span><br><span class="line"><span class="string">html.xpath('</span>//div/a../@<span class="class"><span class="keyword">class</span>')</span></span><br><span class="line">"""属性匹配：[@class='liu']"""</span><br><span class="line"><span class="string">"""文本匹配：text()"""</span>  <span class="comment">#所有文本用//text()</span></span><br><span class="line"><span class="string">"""包含：contains()函数"""</span></span><br><span class="line">html.xpath(<span class="string">'//li[contains(@class,"li")]/a/text()'</span>)</span><br><span class="line"><span class="string">"""多属性匹配：and"""</span></span><br><span class="line">html.xpath(<span class="string">"//li/div[contains(@class,'mo') and @id='titi']/a/text()"</span>)</span><br><span class="line"><span class="string">'''文本包含'''</span></span><br><span class="line">*[text()=<span class="string">'xx'</span>]//text() <span class="comment">#文本包含xx的。。</span></span><br><span class="line">总结：都是在[]里操作</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"""选取第一个li"""</span></span><br><span class="line">html.xpath(<span class="string">'li[1]/a/text()'</span>)</span><br><span class="line"><span class="string">"""选取最后一个li:last()"""</span></span><br><span class="line">html.xpath(<span class="string">'li[last()]/a/text()'</span>)</span><br><span class="line"><span class="string">"""选取倒数第3个li:last()-3"""</span></span><br><span class="line">html.xpath(<span class="string">'li[last()-3]/a/text()'</span>)</span><br><span class="line"><span class="string">"""选取li的前三个：position()"""</span></span><br><span class="line">html.xpath(<span class="string">'li[position()&lt;3]/a/text()'</span>)</span><br></pre></td></tr></table></figure>

<h4 id="Beautiful-Soup"><a href="#Beautiful-Soup" class="headerlink" title="Beautiful Soup"></a>Beautiful Soup</h4><p><strong>直接选择标签</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">soup = BeautifulSoup(html,<span class="string">"lxml"</span>) <span class="comment">#后面的参数是指定lxml解析器,html.parser</span></span><br><span class="line">soup.prettify() <span class="comment">#prɪtifaɪ</span></span><br><span class="line">soup.title.string <span class="comment">#title的文本</span></span><br><span class="line"><span class="string">'''注意：只选择第一个标签'''</span></span><br><span class="line"><span class="string">'''取属性值：attrs['属性名']'''</span></span><br><span class="line">soup.p.attrs[<span class="string">'src'</span>]  <span class="comment">#第一个p，属性为src的值</span></span><br><span class="line">soup.p[<span class="string">'src'</span>]  <span class="comment">#也行</span></span><br><span class="line">soup.p.string <span class="comment">#第一个p里面的文本</span></span><br></pre></td></tr></table></figure>

<p><strong>关联选择</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''和content二进制比较，少一个s'''</span></span><br><span class="line">soup.p.contents <span class="comment">#得到的是p下面所有元素包括属性的列表（难道不鸡肋吗，谁会这么选择）</span></span><br><span class="line">soup.p.children <span class="comment">#一个迭代器。下面所有的子元素</span></span><br><span class="line">soup.p.parent <span class="comment">#p的父结点</span></span><br><span class="line">soup.p.parents <span class="comment">#p的祖先</span></span><br><span class="line"><span class="string">'''下面得到的是一个生成器'''</span></span><br><span class="line">soup.a.next_sibling <span class="comment">#下一个兄弟元素</span></span><br><span class="line">soup.a.previous_sibling <span class="comment">#上一个兄弟元素</span></span><br><span class="line"><span class="string">'''以上都适用于加string和attrs['属性']'''</span></span><br><span class="line">soup.a.parents.string </span><br><span class="line">soup.a.next_sibling.attrs[<span class="string">'class'</span>]</span><br></pre></td></tr></table></figure>

<p><strong>通过find_all方法</strong></p>
<blockquote>
<p>*<em>find_all(name , attrs ,limit, text , \</em>*kwargs) **   </p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">soup.find_all(<span class="string">'ul'</span>) <span class="comment">#查询所有ul元素</span></span><br><span class="line">soup.find_all([<span class="string">'a'</span>,<span class="string">'b'</span>]) <span class="comment">#查找a标签和b标签</span></span><br><span class="line">soup.find_all(re.complie(<span class="string">'^a'</span>)) <span class="comment">#查找a开头的</span></span><br><span class="line"><span class="string">'''通过参数：attrs=&#123;'属性名':'值'&#125;  要是字典,可以传多个'''</span></span><br><span class="line">soup.find_all(<span class="string">'a'</span>,&#123;<span class="string">'id'</span>:<span class="string">'lis-la'</span>,<span class="string">'class'</span>:<span class="string">'ia'</span>&#125;)<span class="comment">#a的..   这种就是attrs</span></span><br><span class="line">soup.find_all(id=<span class="string">'liu'</span>) <span class="comment">#这种就是**kwargs</span></span><br><span class="line">soup.find_all(<span class="string">'a'</span>,class_=<span class="string">'haha'</span>) <span class="comment">#因为class_在python中已经是关键字了</span></span><br><span class="line">soup.find_all(text=re.compile(<span class="string">'link'</span>)) <span class="comment">#可以用re匹配内容</span></span><br><span class="line">soup.find_all(<span class="string">'a'</span>,limit=<span class="number">2</span>) <span class="comment">#'a'标签找两个就行了</span></span><br></pre></td></tr></table></figure>

<p><strong>用select方法</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">soup.select(<span class="string">'ul li'</span>) <span class="comment">#ul下面的li</span></span><br><span class="line">soup.select(<span class="string">'a[class="info"]'</span>) <span class="comment">#xpath为了区别多了一个@</span></span><br><span class="line">soup.select(<span class="string">'#lis.el'</span>) <span class="comment">#类名是lis，且id为el的</span></span><br><span class="line"><span class="keyword">for</span> ul <span class="keyword">in</span> soup.select(<span class="string">'ul'</span>):</span><br><span class="line">    print(ul[<span class="string">'id'</span>])  <span class="comment">#通过属性名获取值</span></span><br><span class="line">    print(ul.get_text())</span><br><span class="line">    print(url.attrs[<span class="string">'href'</span>])</span><br></pre></td></tr></table></figure>

<p><strong>获取文本</strong><code>get_text()</code> <code>string</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''除了string还可以用get_text()获取文本，完全一样'''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> soup.select(<span class="string">'li'</span>):</span><br><span class="line">    print(i.get_text())</span><br></pre></td></tr></table></figure>

<h4 id="PyQuery选择器"><a href="#PyQuery选择器" class="headerlink" title="PyQuery选择器"></a>PyQuery选择器</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pyquert <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">doc = pq(html) </span><br><span class="line"><span class="comment">#doc = pq('https://www.baidu.com')可以直接传网址</span></span><br><span class="line">print(doc(<span class="string">'li'</span>)) <span class="comment">#所有的li</span></span><br><span class="line">print(doc(<span class="string">'#container .list li'</span>)) <span class="comment">#id为container下面类为list 下的li</span></span><br></pre></td></tr></table></figure>

<h5 id="find"><a href="#find" class="headerlink" title="find()"></a>find()</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">doc = pq(html)</span><br><span class="line">items = doc(<span class="string">'.list'</span>).find(<span class="string">'li'</span>) <span class="comment">#查找下面的li</span></span><br><span class="line"></span><br><span class="line">items.children() <span class="comment">#只查找下面的子结点</span></span><br><span class="line">items.children(<span class="string">'.ha'</span>) <span class="comment">#子结点里面id为ha的</span></span><br><span class="line">items.parent() <span class="comment">#只找li上面的父</span></span><br><span class="line">items.parents()<span class="comment">#li上面的祖先</span></span><br><span class="line">items.parents(<span class="string">'.wrap'</span>)</span><br><span class="line">items.siblings() <span class="comment">#兄弟  同样里面也可以传响应的名字</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''获取属性 attr'''</span></span><br><span class="line">item.attr(<span class="string">'src'</span>) <span class="comment"># 通过attr  没有s  获取属性值</span></span><br><span class="line">item.attr.src <span class="comment">#也可以</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''获取文本 text(),和xpath一样'''</span></span><br><span class="line">item.text()</span><br><span class="line"></span><br><span class="line"><span class="string">'''items()所有的'''</span></span><br><span class="line">doc(<span class="string">'li'</span>).items()</span><br><span class="line"></span><br><span class="line"><span class="string">'''获取html里面的文本'''</span></span><br><span class="line">item.html()</span><br></pre></td></tr></table></figure>

<h5 id="添加移除元素"><a href="#添加移除元素" class="headerlink" title="添加移除元素"></a>添加移除元素</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">doc = pq(html)</span><br><span class="line">li = doc(<span class="string">'.liu'</span>)</span><br><span class="line">li.removeClass(<span class="string">'active)</span></span><br><span class="line"><span class="string">li.addClass('</span>active)</span><br></pre></td></tr></table></figure>

<h5 id="伪类元素操作"><a href="#伪类元素操作" class="headerlink" title="伪类元素操作"></a>伪类元素操作</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">doc = pq(html)</span><br><span class="line">li = doc(<span class="string">'li:last-child'</span>)</span><br><span class="line">li = doc(<span class="string">'li:nth-child(2)'</span>)</span><br><span class="line">li = doc(<span class="string">'li:gt(2)'</span>)</span><br></pre></td></tr></table></figure>

<p><strong>实例</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> pyquery <span class="keyword">import</span> PyQuery <span class="keyword">as</span> pq</span><br><span class="line">url = <span class="string">"xx"</span></span><br><span class="line">headers = &#123;<span class="string">"User-Agent"</span>:<span class="string">'xx'</span>&#125;</span><br><span class="line">page_text = requests.get(url,header=header).text</span><br><span class="line">doc = pq(page_text)</span><br><span class="line">items = doc(<span class="string">'.ex .feed'</span>).items()</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    quests = item.find(<span class="string">'h2'</span>).text()</span><br></pre></td></tr></table></figure>

<p><strong>jsonpath</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> jsonpath</span><br><span class="line">books = json.load(<span class="string">'json文件'</span>)</span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.bicycle.color'</span>)</span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[*]'</span>)</span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[0]'</span>) <span class="comment">#book里面有两个元素,并不是指两个book，因为key不会重复的。book:[&#123;0&#125;,&#123;1&#125;]</span></span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[*].title'</span>)</span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[?(@.category=="fiction")]'</span>) <span class="comment">#?()过滤</span></span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[?(@.price&lt;10)]'</span>) <span class="comment"># @. 当前结点</span></span><br><span class="line"></span><br><span class="line">jsonpath.jsonpath(books,<span class="string">'$.store.book[?(@.abc)]'</span>) <span class="comment">#含有abc的。abcd也叫含有abc</span></span><br><span class="line"></span><br><span class="line">$..name 不管位置</span><br></pre></td></tr></table></figure>

<h4 id="Aiohttp高并发"><a href="#Aiohttp高并发" class="headerlink" title="Aiohttp高并发"></a>Aiohttp高并发</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">多进程/线程的好处： 解决IO阻塞问题</span><br><span class="line">坏处：无法人为控制线程/进程的数量，占用系统资源，拖慢系统速度，而且更容易进入假死状态。</span><br><span class="line">解决办法：用进程/线程池塘</span><br><span class="line">进程/线程池好处：处理了系统开销，可以人为控制线程数量</span><br><span class="line">坏处：线程池的大小要结合请求来控制，大了一样占用系统开销。小了效果不明显。</span><br><span class="line">解决：结合网络，自身硬件，合理控制池的大小。</span><br><span class="line">案例：基于multiprocessing.dummy <span class="keyword">import</span> Pool <span class="comment">#进程里的线程池</span></span><br><span class="line"><span class="comment">#p = Pool(4) p.map(fun,迭代对象) map本身就是一个迭代对象，可以作为参数哟</span></span><br><span class="line">concurrent.futures <span class="keyword">import</span> ThreadPoolExecutor,ProcessPoolExecutor 这也是一个线程池模块</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myThread</span><span class="params">(a,b,c)</span>:</span></span><br><span class="line">    Thread = ThreadPoolExecutor(<span class="number">2</span>)</span><br><span class="line">    Thread.submit(fun,<span class="number">1</span>) <span class="comment">#submit和map区别就是 一个可以传单数，一个必须是列表</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myPeocess</span><span class="params">()</span>:</span></span><br><span class="line">    Process = ProcessPoolExecutor(<span class="number">2</span>)</span><br><span class="line">    Process.submit(myThread,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) <span class="comment">#看好哟，这个参数，map不能这样哟</span></span><br></pre></td></tr></table></figure>



<p>多进程：计算密集型</p>
<p>多线程：io密集型（文件处理，网络交互）</p>
<p>协程：单线程，轻量级线程。没有进程，线程之间的切换开销。无须操作系统调度，适用io密集型</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">为什么要用队列？</span><br><span class="line">	答：python原生的数据类型都是线程不安全的，需要加锁。而queue是线程安全的，实现了锁</span><br><span class="line"><span class="attribute">import</span> queue</span><br><span class="line">q = queue.Queue() <span class="comment">#先进先出</span></span><br><span class="line">q = queue.LifoQueue() <span class="comment">#后进先出stack</span></span><br><span class="line">q.get() <span class="comment">#</span></span><br><span class="line">q.get(block=True,timeout=None) <span class="comment">#为空则阻塞，等到里面来数据</span></span><br><span class="line">q.put(bolck=True,timeout=None) <span class="comment"># 为满则阻塞，等到里面数据取走</span></span><br><span class="line">q.get(block=False,timeout=None) <span class="comment">#为空则报Empty错</span></span><br><span class="line">q.get_nowait() <span class="comment">#等同get(block=False)</span></span><br><span class="line">q.put_nowait() </span><br><span class="line">q.task_done() <span class="comment">#向已经完成的任务发一个信号</span></span><br><span class="line">q.join() <span class="comment">#阻塞</span></span><br><span class="line">q.qsize() <span class="comment">#看队列里面放了多少</span></span><br><span class="line">q.empty()是否为空</span><br><span class="line">q.full() 是否满了</span><br><span class="line">要明白阻塞的含义：他会一直等，程序卡在那，所有加block=False或者q.empty()/full()很重要</span><br></pre></td></tr></table></figure>

<p><strong>asyncio 和异步的http请求库aiohttp配合，实现异步协程，只怪requests不是异步的http</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> aiohttp</span><br><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">def</span> <span class="title">hello</span><span class="params">(url)</span>:</span></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">with</span> aiohttp.ClientSession() <span class="keyword">as</span> session:</span><br><span class="line">		<span class="keyword">async</span> <span class="keyword">with</span> session.get(url) <span class="keyword">as</span> response:</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">await</span> response.text() <span class="comment">#注意是text(encoding='utf-8') 可以传参</span></span><br><span class="line">            <span class="comment">#response.json()#还是一样的</span></span><br><span class="line">            <span class="comment">#response.read() #字节流，和urllib模块里的一样</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">	url  = xx</span><br><span class="line">    task = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(xxx):</span><br><span class="line">        task = asyncio.ensure_future(hello(xx)) <span class="comment">#hello(xx)异步函数？不是应该是另一个函数吗</span></span><br><span class="line">        task.add_done_callback(fun)<span class="comment">#回调的函数</span></span><br><span class="line">        tasks.append(task)</span><br><span class="line">	loop = asyncio.get_event_loop() <span class="comment">#获取事件循环</span></span><br><span class="line">	<span class="comment">#result = loop.run_until_complete(hello(url)) #事件循环运行直到完成</span></span><br><span class="line">	<span class="comment">#result = loop.run_until_complete(asyncio.gather(*tasks))#gather收集全部的响应结果</span></span><br><span class="line">    <span class="comment">#loop.run_until_complete(asyncio.wait(tasks))</span></span><br></pre></td></tr></table></figure>

<h4 id="数据存储"><a href="#数据存储" class="headerlink" title="数据存储"></a>数据存储</h4><p><code>json.dumps(data,ident=2,ensure_ascii=False) ident缩进两个字符，更直观</code></p>
<p><code>json.dump({xx},open(&#39;xx.json&#39;),ensure_ascii=False) 直接写入文件</code></p>
<h5 id="CSV"><a href="#CSV" class="headerlink" title="CSV"></a>CSV</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> csv</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'demo.csv'</span>,<span class="string">'w'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    writer = csv.writer(f)  <span class="comment">#csv.writer(f,delimiter=' ') 指定分隔符</span></span><br><span class="line">    writer.writerow([<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>]) <span class="comment">#一次writerow写一行</span></span><br><span class="line">    writer.writerow([<span class="string">'01'</span>,<span class="string">'z3'</span>,<span class="string">'18'</span>])</span><br><span class="line">    writer.writerow([<span class="string">'02'</span>,<span class="string">'l4'</span>,<span class="string">'19'</span>])</span><br><span class="line">    </span><br><span class="line">    <span class="string">'''用二维表写入多行'''</span></span><br><span class="line">    writer.writerow([<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>])</span><br><span class="line">    writer.writerow([[<span class="string">'03'</span>,<span class="string">'w5'</span>,<span class="string">'20'</span>],[<span class="string">'04'</span>,<span class="string">'z6'</span>,<span class="string">'21'</span>],[<span class="string">'05'</span>,<span class="string">'x7'</span>,<span class="string">'22'</span>]])</span><br></pre></td></tr></table></figure>

<p><strong>写字典</strong></p>
<p><code>在原基础上多了一个field字段和writeheader</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'demo.csv'</span>,<span class="string">'a'</span>,encoding=<span class="string">'utf-8'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    fieldnames = [<span class="string">'id'</span>,<span class="string">'name'</span>,<span class="string">'age'</span>]</span><br><span class="line">    writer = csv.DicWriter(f,fieldnames=fieldnames)</span><br><span class="line">    writer.writeheader() <span class="comment">#写入头部</span></span><br><span class="line">    </span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>:<span class="string">'01'</span>,<span class="string">'name'</span>:<span class="string">'liu'</span>,<span class="string">'22'</span>&#125;)  <span class="comment">#字段对应 </span></span><br><span class="line">    writer.writerow(&#123;<span class="string">'id'</span>:<span class="string">'01'</span>,<span class="string">'name'</span>:<span class="string">'liu'</span>,<span class="string">'22'</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><strong>读</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'demo.csv'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    reader = csv.reader(f)</span><br><span class="line">    <span class="comment">#reader = csv.DictReader(f)</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> reader:</span><br><span class="line">        print(i)</span><br><span class="line">        </span><br><span class="line"><span class="string">'''采用pandas读'''</span></span><br><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">pd.read_csv(<span class="string">'demo.csv'</span>)</span><br></pre></td></tr></table></figure>

<h5 id="pymysql"><a href="#pymysql" class="headerlink" title="pymysql"></a>pymysql</h5><p><code>ACID</code>  <code>atom:原子性</code> <code>consistency:一致性</code> <code>isolation:隔离性</code> <code>Durability:持久性</code></p>
<blockquote>
<p>视图的作用：隐藏数据复杂性；有利于用户对于数据库中某些列数据的访问 </p>
<p>innodb 支持事务，可以回滚。支持外键，删除是一行行删，效率低；myisam 反之</p>
</blockquote>
<p><strong>创建数据库</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pymysql</span><br><span class="line">db = pymysql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'123456'</span>,port=<span class="number">3306</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">"select version()"</span>)</span><br><span class="line">data = cursor.fetchone()  <span class="comment">#拿到第一条数据</span></span><br><span class="line">print(data) </span><br><span class="line">print(cursor.rowcount) <span class="comment">#看行数</span></span><br><span class="line"></span><br><span class="line">cursor.execute(<span class="string">'create database spider default character set utf8'</span>) <span class="comment">#默认字符设置</span></span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p><strong>创建表</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">db = pymsql.connect(host=<span class="string">'localhost'</span>,user=<span class="string">'root'</span>,password=<span class="string">'xxxx'</span>,port=<span class="number">3306</span>,db=<span class="string">'spider'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">"create table if not exists students (id varchar(255) not null,name varchar(255) not null,age int not null,primary key(id))"</span></span><br><span class="line">cursor.execute(sql)</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p><strong>插入语句</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">num = <span class="string">'20120456'</span>;user = <span class="string">'Bob'</span>;age = <span class="number">22</span></span><br><span class="line">db = pymysql.connect(host=<span class="string">"localhost"</span>,user=<span class="string">'root'</span>,password=<span class="string">'6679448'</span>,port=<span class="number">3306</span>,db=<span class="string">'spider'</span>)</span><br><span class="line">cursor = db.cursor()</span><br><span class="line">sql = <span class="string">'insert into students(id,name,age) values (%s,%s,%s)'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,(num,user,age)) <span class="comment">#元组</span></span><br><span class="line">    db.commit()</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    db.rollback()</span><br><span class="line">db.close()</span><br></pre></td></tr></table></figure>

<p><strong>推荐通用插入</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;<span class="string">'id'</span>:<span class="string">"2012456"</span>,<span class="string">"age"</span>:<span class="string">'22'</span>,<span class="string">'name'</span>:<span class="string">'Bob'</span>&#125;</span><br><span class="line">table = <span class="string">"students"</span></span><br><span class="line">keys = data.keys() </span><br><span class="line">keys = <span class="string">","</span>.join(keys)    <span class="comment"># 'id,age,name'</span></span><br><span class="line">values = data.values()</span><br><span class="line">values = <span class="string">","</span>join(len(values)*[<span class="string">'%s'</span>])   <span class="comment"># '%s,%s,%s'</span></span><br><span class="line">sql = <span class="string">'insert into &#123;&#125;(&#123;&#125;) value (&#123;&#125;)'</span>.format(table,keys,values)</span><br><span class="line"><span class="comment">#sql = f'insert into &#123;table&#125;(&#123;keys&#125;) values (&#123;values&#125;)' #这是新语法，比上面的好多了</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,tupe(data.values())) <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p><strong>更新数据库</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">"update students set age=%s where name=%s"</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql,(<span class="number">25</span>,<span class="string">'Tom'</span>))</span><br><span class="line">    db.commit()</span><br></pre></td></tr></table></figure>

<p><strong>推荐更新数据库方法：如果数据存在则更新，不存在则插入</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">data = &#123;<span class="string">'id'</span>:<span class="string">'2012996'</span>,<span class="string">'name'</span>:<span class="string">'Tom'</span>,<span class="string">'age'</span>:<span class="number">21</span>&#125;</span><br><span class="line">table = <span class="string">'students'</span></span><br><span class="line">keys = data.keys()</span><br><span class="line">keys = <span class="string">','</span>.join(keys)</span><br><span class="line">values = data.values()</span><br><span class="line">values = <span class="string">','</span>.join(len(values)*[<span class="string">'%s'</span>])</span><br><span class="line">sql = <span class="string">f"insert into <span class="subst">&#123;table&#125;</span>(<span class="subst">&#123;keys&#125;</span> values (<span class="subst">&#123;values&#125;</span>) on duplicate key update)"</span></span><br><span class="line">update = <span class="string">','</span>.join([<span class="string">f"<span class="subst">&#123;key&#125;</span>=%s"</span> <span class="keyword">for</span> key <span class="keyword">in</span> data])   </span><br><span class="line">sql += update</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">if</span> cursor.execute(sql,tuple(data.values())*<span class="number">2</span>):</span><br><span class="line">        print(<span class="string">"Successful"</span>)</span><br><span class="line">        db.commit()</span><br></pre></td></tr></table></figure>

<p><strong>删除数据库</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">table = <span class="string">"students"</span></span><br><span class="line">condition = <span class="string">'age &gt; 20'</span></span><br><span class="line">sql = <span class="string">f"delete from <span class="subst">&#123;table&#125;</span> where <span class="subst">&#123;condition&#125;</span>"</span></span><br></pre></td></tr></table></figure>

<p><strong>查询数据库</strong><code>fetchone()才能看结果</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">sql = <span class="string">'select * from students where age &gt;= 20'</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	cursor.execute(sql)</span><br><span class="line">	cursor.fetchone()</span><br><span class="line">	cursor.fetchall()</span><br><span class="line"><span class="keyword">except</span>；</span><br><span class="line">	print(<span class="string">'Error'</span>)</span><br><span class="line"><span class="string">"""推荐读取方式，对于大型数据库查询"""</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    cursor.execute(sql)</span><br><span class="line">    row = cursor.fetchone()</span><br><span class="line">    <span class="keyword">while</span> row:</span><br><span class="line">        row = cursor.fetchone()</span><br><span class="line">        print(row)</span><br></pre></td></tr></table></figure>

<p><strong>非关系形数据库</strong>：</p>
<ul>
<li>键值存储：redis</li>
<li>列存储:Riak</li>
<li>文档型：mongodb</li>
<li>图形：Graph</li>
</ul>
<h5 id="pymongo"><a href="#pymongo" class="headerlink" title="pymongo"></a>pymongo</h5><p><code>mongodb不支持事务</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''指定数据库'''</span></span><br><span class="line">client= pymongo.MongoClient(host=<span class="string">"localhost"</span>,port=<span class="number">27017</span>)</span><br><span class="line">db = client.test  <span class="comment">#指定数据库</span></span><br><span class="line">db = client[<span class="string">'test'</span>] <span class="comment">#一样的实现</span></span><br><span class="line"><span class="string">'''指定集合'''</span></span><br><span class="line">collection = db.students <span class="comment">#指定集合 ，集合类似于 ’表‘</span></span><br><span class="line">collection = db[<span class="string">'students'</span>]  <span class="comment">#一样的实现</span></span><br><span class="line"><span class="string">'''插入数据'''</span></span><br><span class="line">result = collection.insert_one(字典)<span class="comment">#result.inserted_id  获取id</span></span><br><span class="line">result = collection.insert_many([字典<span class="number">1</span>，字典<span class="number">2</span>]) <span class="comment">#result.inserted_ids获取id列表</span></span><br><span class="line"><span class="string">'''查询'''</span></span><br><span class="line">result = collection.find_one(字典)</span><br><span class="line">result = collection.find_one(&#123;<span class="string">'age'</span>:&#123;<span class="string">'$gt'</span>:<span class="number">20</span>&#125;&#125;) <span class="comment">#'$gt':20 年龄大于20的</span></span><br><span class="line">result = collection.find_one(&#123;<span class="string">"$or"</span>:[&#123;<span class="string">"name"</span>:<span class="string">"小明"</span>&#125;,&#123;<span class="string">"name"</span>:<span class="string">"小王"</span>&#125;]&#125;)</span><br><span class="line">result = collection.find_one(&#123;<span class="string">"_id"</span>:&#123;<span class="string">"$gt"</span>:<span class="number">20</span>,<span class="string">'$gl'</span>:<span class="number">100</span>&#125;&#125;) <span class="comment">#大于20，小于100的</span></span><br><span class="line"><span class="string">'''利用正则查询'''</span></span><br><span class="line">collection.find_one(&#123;<span class="string">"name"</span>:&#123;<span class="string">"$regex"</span>:<span class="string">"^a.*"</span>&#125;&#125;) <span class="comment">#开头为a的，后面.*任意</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''计数'''</span></span><br><span class="line">collection.find().count()</span><br><span class="line"><span class="string">'''排序'''</span></span><br><span class="line">collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING) <span class="comment">#asc ending</span></span><br><span class="line"><span class="string">"""偏移"""</span></span><br><span class="line">collection.find().sort(<span class="string">'name'</span>,pymongo.ASCENDING).skip(<span class="number">2</span>) <span class="comment">#偏移两个</span></span><br><span class="line">collection.find().sort(<span class="string">"name"</span>,pymongo.ASCENDING).skip(<span class="number">2</span>).limit(<span class="number">2</span>) <span class="comment">#limit取几个</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''更新 用&#123;"$set":&#125; 则更新，无set则替换'''</span></span><br><span class="line">result = collection.update_one(&#123;<span class="string">'name'</span>:<span class="string">"liuqinggui"</span>&#125;,&#123;<span class="string">"$set"</span>:&#123;<span class="string">'age'</span>:<span class="number">123</span>&#125;&#125;)</span><br><span class="line"><span class="comment">#result.matched_count和result.modified_count 匹配条数和修改的条数</span></span><br><span class="line">collection.update_one(&#123;<span class="string">'name'</span>:<span class="string">'liuqinggui'</span>&#125;,&#123;<span class="string">"$inc"</span>:&#123;<span class="string">"age"</span>:<span class="number">1</span>&#125;&#125;)  <span class="comment">#年龄+1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''删除：虽然有remove，但是推荐用delete'''</span></span><br><span class="line">collection.delete_many(&#123;&#125;)<span class="comment">#.deleted_count 可以看条数</span></span><br></pre></td></tr></table></figure>

<h5 id="from-redis-import-StrictRedis"><a href="#from-redis-import-StrictRedis" class="headerlink" title="from redis import StrictRedis"></a>from redis import StrictRedis</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis <span class="comment">#官方推荐</span></span><br><span class="line">redis = StrictRedis(host=<span class="string">'localhost'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>)<span class="comment">#没有密码就不写password='xxx'。这里用的0号库</span></span><br><span class="line">redis.set(<span class="string">'name'</span>,<span class="string">'Bob'</span>)</span><br><span class="line">print(redis.get(<span class="string">"name"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment">#还可以用下面的方式连接</span></span><br><span class="line"><span class="keyword">from</span> redis <span class="keyword">import</span> StrictRedis,Connection</span><br><span class="line">pool = Connection(host=<span class="string">'localhost'</span>,port=<span class="number">6379</span>,db=<span class="number">0</span>)</span><br><span class="line">redis = StricRedis(connect_pool=pool)</span><br></pre></td></tr></table></figure>

<h5 id="sqlalchemy"><a href="#sqlalchemy" class="headerlink" title="sqlalchemy"></a>sqlalchemy</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> sqlalchemy <span class="keyword">import</span> create_engine,Column,Integer,String,DateTime</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.ext.declarative <span class="keyword">import</span> declarative_base</span><br><span class="line"><span class="keyword">from</span> sqlalchemy.orm <span class="keyword">import</span> sessionmaker</span><br><span class="line">engine = create_engine(<span class="string">"mysql+pymysql://root:123@localhost:3306/test?charset=utf-8"</span>,echo=<span class="literal">True</span>)</span><br><span class="line">Base = declarative_base()</span><br><span class="line">DBSession = sessionmaker(bind=engine)</span><br><span class="line">sesion = DBSession() <span class="comment">#创建会话用于执行sql语句</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">mytable</span><span class="params">(Base)</span>:</span></span><br><span class="line">    __tablename__ = <span class="string">'mytable'</span> <span class="comment">#一般和类名一样</span></span><br><span class="line">    Id = Column(Integer(),primary_key=<span class="literal">True</span>)</span><br><span class="line">    name = Column(String(<span class="number">30</span>),unique=<span class="literal">True</span>)</span><br><span class="line">    age = Column(DateTime,comment=<span class="string">'时间'</span>)</span><br><span class="line">Base.metadata.create_all(engine)  <span class="comment">#创建数据表</span></span><br><span class="line">Base.metadata.drop_all(engine) <span class="comment">#删除</span></span><br><span class="line"></span><br><span class="line">new_data = mytable(name=<span class="string">'Li Lei'</span>,age=<span class="number">10</span>)</span><br><span class="line">session.add(new_data)</span><br><span class="line">session.commit()</span><br><span class="line">session.close()</span><br></pre></td></tr></table></figure>

<h4 id="pyppeteer"><a href="#pyppeteer" class="headerlink" title="pyppeteer"></a>pyppeteer</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> pyppeteer <span class="keyword">import</span> launch</span><br><span class="line"><span class="keyword">async</span> main():</span><br><span class="line">    browser = <span class="keyword">await</span> launch()<span class="comment">#默认无头，里面可以设置</span></span><br><span class="line">    page = <span class="keyword">await</span> browser.newPage()</span><br><span class="line">    <span class="keyword">await</span> page.setUserAgent(<span class="string">'xxx'</span>) <span class="comment">#UA伪装</span></span><br><span class="line">    <span class="keyword">await</span> page.goto(<span class="string">'https://xx'</span>)</span><br><span class="line">   	<span class="keyword">await</span> page.setViewport(&#123;<span class="string">"width"</span>:<span class="number">800</span>,<span class="string">'height'</span>:<span class="number">900</span>&#125;) <span class="comment">#设置窗口大小</span></span><br><span class="line">    <span class="keyword">await</span> page.evaluate(<span class="string">'window.srollTo(0,document.body.scrollHeight)'</span>)<span class="comment">#执行js语句</span></span><br><span class="line">    <span class="keyword">await</span> page.type(<span class="string">'#kw'</span>,<span class="string">'周杰伦'</span>,&#123;<span class="string">'delay'</span>: <span class="number">1000</span>&#125;) <span class="comment">#选择</span></span><br><span class="line">    <span class="keyword">await</span> page.click(<span class="string">'#su'</span>) <span class="comment">#*</span></span><br><span class="line">    page_source = <span class="keyword">await</span> page.content() <span class="comment">#这是方法噢</span></span><br><span class="line">    print(page_source)</span><br><span class="line">    asyncio.sleep(<span class="number">2</span>) <span class="comment">#睡两秒</span></span><br><span class="line">    <span class="keyword">await</span> browser.close()</span><br><span class="line">asyncio.get_event_loop().run_until_complete(main())</span><br><span class="line"><span class="comment">#还可以先用选择器选择后再单击</span></span><br><span class="line">alist = <span class="keyword">await</span> page.querySelectorAll(<span class="string">'.s_tab_inner &gt; a'</span>)</span><br><span class="line"><span class="keyword">await</span> alist[<span class="number">3</span>].click()</span><br><span class="line"><span class="comment">#---------------------------------------------</span></span><br><span class="line">launch(<span class="literal">False</span>,headless,executablePath.args,devtools)<span class="comment">#默认忽略HTTPs错误</span></span><br><span class="line">headless = <span class="literal">True</span> <span class="comment">#开启有头</span></span><br><span class="line">executablePath =<span class="string">r''</span><span class="comment">#自定浏览器驱动路径</span></span><br><span class="line">args = <span class="comment">#可以传入参数</span></span><br><span class="line">devtools =<span class="literal">False</span> <span class="comment">#是否开启自动调试</span></span><br><span class="line"><span class="comment">#关闭 “Chrome正手动自动测试软件控制”提示</span></span><br><span class="line">launch(headless=<span class="literal">False</span>,args=[<span class="string">'--disable-infobars'</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment">#------规避检测--------</span></span><br><span class="line">js = <span class="string">'''() =&gt;&#123; Object.defineProperties(navigator,&#123; webdriver:&#123; get: () =&gt; false &#125; &#125;) &#125;'''</span></span><br><span class="line"><span class="comment">#js = 'Object.defineProperty(navigator,"webdriver",&#123; get: () =&gt; false &#125;)'#书上这这行</span></span><br><span class="line"><span class="keyword">await</span> page.evaluate(js)</span><br><span class="line"></span><br><span class="line"><span class="comment">#------------- task.result()就是主函数的返回值</span></span><br><span class="line">tasks = []</span><br><span class="line">task1 = asyncio.ensure_future(main)</span><br><span class="line">task1.add_done_callback(parse)</span><br><span class="line">tasks.append(task1)</span><br><span class="line">asyncio.get_event_loop().run_until_complete(asyncio.wait(tasks))</span><br></pre></td></tr></table></figure>

<h4 id="selenium"><a href="#selenium" class="headerlink" title="selenium"></a>selenium</h4><p><code>XHR</code>  <em>XML Http Request</em></p>
<p><strong>ajax原理</strong>  </p>
<p>异步的JavaScript和xml</p>
<ul>
<li>发送请求</li>
<li>解析内容</li>
<li><strong>渲染页面</strong></li>
</ul>
<p><code>NoSuchElementException :</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> Select</span><br><span class="line"><span class="string">'''这种方式可以填写表单'''</span></span><br><span class="line">select = Select(bro.find_element_by_name(<span class="string">'status'</span>)) <span class="comment">#表单的名字，也可以通过id定位表单</span></span><br><span class="line">select.select_by_index(<span class="number">1</span>) <span class="comment">#根据索引选择</span></span><br><span class="line">select.select_by_value(<span class="string">'0'</span>) <span class="comment">#通过value属性值，是属性值</span></span><br><span class="line">select.select_by_visible_text(<span class="string">"未审核"</span>) <span class="comment">#通过可见的文本选择</span></span><br><span class="line">select.deselect_all() <span class="comment">#全部取消</span></span><br><span class="line"></span><br><span class="line">bro = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    bro.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">    input = bro.find_element_by_id(<span class="string">"kw"</span>)</span><br><span class="line">    <span class="comment">#input = bro.find_element(By.ID,'kw') </span></span><br><span class="line">    <span class="comment">#input = bro.find_elements(By.ID,'kw) 这有s是所有id为kw的</span></span><br><span class="line">    input.send_keys(<span class="string">'Python'</span>)   </span><br><span class="line">    input.send_keys(Keys.ENTER)  <span class="comment">#RETURN和ENTER一样</span></span><br><span class="line">    input.send_keys(Keys.CONTROL,<span class="string">'a'</span>) <span class="comment">#全选</span></span><br><span class="line">    input.send_keys(Keys.SPACE) <span class="comment">#空格</span></span><br><span class="line">    </span><br><span class="line">    wait = WebDriverWait(bro,<span class="number">10</span>)</span><br><span class="line">    wait.until(EC.presence_of_element_located((By.ID,<span class="string">'content_left'</span>)))<span class="comment">#元组</span></span><br><span class="line">    </span><br><span class="line">    <span class="string">'''浏览器bro的操作'''</span></span><br><span class="line">    print(bro.current_url) </span><br><span class="line">    print(bro.get_cookies())</span><br><span class="line">    print(bro.page_source) </span><br><span class="line">    bro.back()</span><br><span class="line">    bro.forward()</span><br><span class="line">    bro.get_cookies()</span><br><span class="line">    bro.delete_all_cookies()</span><br><span class="line">    bro.get_screenshot_as_png() <span class="comment">###这样拿到的是图片的字节数据</span></span><br><span class="line">    bro.save_screenshot(<span class="string">'a.png'</span>) <span class="comment">#这样是直接保存</span></span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    bro.close() <span class="comment">#关闭标签</span></span><br><span class="line">    bro.quit() <span class="comment"># 退出浏览器</span></span><br><span class="line">    </span><br><span class="line">submit和click的？submit只能用于表单的提交，click是独立事件，什么都能做</span><br><span class="line">submit和map的区别？</span><br><span class="line">    </span><br><span class="line"><span class="string">''' ######定位的标签后最最常用的操作########'''</span></span><br><span class="line">inpu.clear() </span><br><span class="line">inpu.click() </span><br><span class="line">inpu.send_keys(<span class="string">'xx'</span>)</span><br><span class="line">inpu.get_attribute(<span class="string">'class'</span>)  </span><br><span class="line"></span><br><span class="line">inpu.text        <span class="comment">#获取文本值，</span></span><br><span class="line">inpu.size   <span class="comment">#&#123;'x': 121, 'y': 527&#125;节点大小</span></span><br><span class="line">inpu.location   <span class="comment">#&#123;'height': 140, 'width': 121&#125;</span></span><br><span class="line">inpu.tag_name   <span class="comment">#获取标签名</span></span><br><span class="line"></span><br><span class="line">cookies = driver.get_cookies() <span class="comment">#添加cookies</span></span><br><span class="line">cookie_dict = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cookies:</span><br><span class="line">    cookie_dict[i[<span class="string">'name'</span>]] = i[<span class="string">'values'</span>]</span><br><span class="line">cookie_dict</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''动作链'''</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ActionChains <span class="comment">#</span></span><br><span class="line"><span class="comment">#from selenium.webdriver.common.action_chains import ActionsChains 宫哥的动作</span></span><br><span class="line">bro = webdriver.Chrome()</span><br><span class="line">bro.get(<span class="string">"https://baidu.com"</span>)</span><br><span class="line">bro.switch_to_alert().accept() <span class="comment">#dismiss() #处理弹窗</span></span><br><span class="line">bro.switch_to.frame(<span class="string">"框架名"</span>) </span><br><span class="line">bro.switch_to.frame(aa)  <span class="comment">#我看必须要先定位到框架，不能直接填框架名</span></span><br><span class="line"><span class="comment">#switch_to.widow(bro.window_handles[1]) 切换窗口</span></span><br><span class="line">bro.switch_to.default_content() <span class="comment">#切换到默认的窗口</span></span><br><span class="line"></span><br><span class="line">source = bro.find_element_by_id(<span class="string">"kw1"</span>)</span><br><span class="line">target = bro.find_element_by_id(<span class="string">"kw2"</span>)</span><br><span class="line">actions = ActionChains(bro) <span class="comment">#首先要创建动作链实例</span></span><br><span class="line">actions.send_keys(Keys.PAGE_DOWN).perform() <span class="comment">#下滑   </span></span><br><span class="line">actions.drag_and_drop(source,target)</span><br><span class="line">actions.drag_and_drop_offset(element,<span class="number">100</span>,<span class="number">0</span>)<span class="comment">#x,y</span></span><br><span class="line">actions.click_and_hold(slider)</span><br><span class="line">action.move_by_offset(x,<span class="number">0</span>) <span class="comment">#这一步可以不用表演</span></span><br><span class="line">action.release().perform() <span class="comment">#松开也要表演</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#拖动滑动条</span></span><br><span class="line">element = driver.find_element_by_class_name(<span class="string">"xxx"</span>) <span class="comment">#滑动条定位</span></span><br><span class="line">action.drag_and_drop_by_offset(element,<span class="number">100</span>,<span class="number">0</span>).perform() <span class="comment">#滑动条拖动100</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''执行JavaScript'''</span></span><br><span class="line">bro.execute_script(<span class="string">'window.scrollTo(0,document.body.scrollHeight)'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">'''窗口切换'''</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">browser.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"></span><br><span class="line">browser.execute_script(<span class="string">'window.open()'</span>)  <span class="comment">#打开一个新窗口，open('里面可以输入网址！')</span></span><br><span class="line">browser.switch_to.window(browser.window_handles[<span class="number">1</span>]) <span class="comment">#切换到第一个窗口，打开tb</span></span><br><span class="line"></span><br><span class="line">browser.get(<span class="string">'https://taobao.com'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''规避监测'''</span><span class="comment">#window.navigator.webdriver要等于 非true</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver <span class="keyword">import</span> ChromeOptions</span><br><span class="line">options = ChromeOptions()</span><br><span class="line">options.add_experimental_option(<span class="string">'excludeSwitches'</span>, [<span class="string">'enable-automation'</span>]) </span><br><span class="line">options.add_experimental_option(<span class="string">"prefs"</span>, &#123;<span class="string">"profile.managed_default_content_settings.images"</span>: <span class="number">2</span>&#125;) <span class="comment"># 不加载图片,加快访问速度</span></span><br><span class="line">webdriver.Chrome(options=options)</span><br><span class="line"><span class="comment">#有的书上没有导入，直接options = webdriver.ChromeOptions(),这和我理解动作连一样，大概都行吧</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''谷歌无头'''</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.chrome.options <span class="keyword">import</span> Options</span><br><span class="line">chrome_options = Options()</span><br><span class="line">chrome_options.add_argument(<span class="string">"--headless"</span>)</span><br><span class="line">chrome_options.add_argument(<span class="string">'--disable-gpu'</span>)</span><br><span class="line">chrome_options.add_argument(<span class="string">'lang=zh_CN.UTF-8'</span>) <span class="comment">#可以添加一些信息</span></span><br><span class="line">chrome_options.add_argument(<span class="string">"User-Agent="</span>+<span class="string">'Mozilla/50.....'</span>) </span><br><span class="line"><span class="string">'''设置代理'''</span></span><br><span class="line">proxy = <span class="string">'127.0.0.1:8859'</span></span><br><span class="line">chrome_options.add_argument(<span class="string">'--proxy-server=https://'</span>+proxy)</span><br><span class="line">bro = webdriver.Chrome(chrome_options=chrome_options)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''显式等待：全部是元组'''</span></span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait  <span class="comment">#ui</span></span><br><span class="line">bro = webdriver.Chrome()</span><br><span class="line">bro.get(<span class="string">'https://www.baidu.com'</span>)</span><br><span class="line"></span><br><span class="line">wait = WebDriverWait(bro,<span class="number">10</span>)</span><br><span class="line">inp = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'kw'</span>)))  <span class="comment">#元素加载出来了就...</span></span><br><span class="line">inpu.click()</span><br><span class="line"></span><br><span class="line">button = wait.until(EC.element_to_be_clickable((By.ID,<span class="string">'btn-sear'</span>)))  <span class="comment">#元素可以点击了就..</span></span><br><span class="line">button.send_keys(<span class="string">'随便'</span>) </span><br><span class="line"></span><br><span class="line"><span class="string">'''  ####****##'''</span></span><br><span class="line">wait.until(EC.text_to_be_present_in_element((By.ID,<span class="string">'xx'</span>),str(xxx))) <span class="comment">#某个节点包含某文字</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''异常处理'''</span></span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException,NoSuchElementException</span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.get(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line"><span class="keyword">except</span> TimeoutException:</span><br><span class="line">    print(<span class="string">'Time Out'</span>)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    browser.find_element_by_id(<span class="string">'kw'</span>)</span><br><span class="line"><span class="keyword">except</span> NoSuchElementException:</span><br><span class="line">    print(<span class="string">"No Element"</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    browser.close()</span><br></pre></td></tr></table></figure>

<h4 id="lua"><a href="#lua" class="headerlink" title="lua"></a>lua</h4><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//固定main</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash,args)</span></span></span><br><span class="line">    splash:go(<span class="string">"https://www.baidu.com"</span>)</span><br><span class="line">    splash:wait(<span class="number">0.5</span>)</span><br><span class="line">    <span class="keyword">local</span> title = splash:evaljs(<span class="string">"document.title"</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;title=title&#125;  </span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(spalsh,args)</span></span></span><br><span class="line">    <span class="built_in">assert</span>(splash:go(args.url))</span><br><span class="line">    <span class="built_in">assert</span>(splash:wait(<span class="number">0.5</span>))</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        html = splash:html(), <span class="comment">-- 源码</span></span><br><span class="line">        png = splash:png(),  <span class="comment">-- 截图</span></span><br><span class="line">        har = splash:har(), <span class="comment">-- HAR信息</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3</span>个站点的截图</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash,args)</span></span></span><br><span class="line">    <span class="keyword">local</span> example_urls = &#123;<span class="string">'www.baidu.com'</span>,<span class="string">'www.taobao.com'</span>,<span class="string">'...'</span>&#125;</span><br><span class="line">    <span class="keyword">local</span> urls = args.urls <span class="keyword">or</span> example_urls</span><br><span class="line">    <span class="keyword">local</span> results = &#123;&#125;</span><br><span class="line">    <span class="keyword">for</span> index,url <span class="keyword">in</span> <span class="built_in">ipairs</span>(urls) <span class="keyword">do</span></span><br><span class="line">        <span class="keyword">local</span> ok,reason = splash:go(<span class="string">'https://'</span> .. url) <span class="comment">-- ..是拼接</span></span><br><span class="line">        <span class="keyword">if</span> ok <span class="keyword">then</span></span><br><span class="line">            splash:wait(<span class="number">2</span>)</span><br><span class="line">            results[url] = splash:png()</span><br><span class="line">		<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">end</span></span><br><span class="line">	<span class="keyword">return</span> results</span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- splash属性,splash打点直接操作</span></span><br><span class="line">.scroll_position = &#123;y=<span class="number">40</span>&#125; <span class="comment">--table类型 下滚</span></span><br><span class="line">.scroll_position = &#123;x=<span class="number">100</span>,y=<span class="number">200</span>&#125; <span class="comment">-- 左右滚动</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- splash方法</span></span><br><span class="line">:go(url,headers,http_method,body,formdata)</span><br><span class="line">http_get(url,headers,follow_redirects)</span><br><span class="line">http_post(url,headers,body)</span><br><span class="line">wait(<span class="built_in">time</span>,cancel_on_redirect,cancel_on_error)</span><br><span class="line">jsfunc(<span class="string">[[代码]]</span>)#必须用双括号包</span><br><span class="line">evaljs(js代码)</span><br><span class="line">autoload()</span><br><span class="line"><span class="function"><span class="keyword">function</span><span class="params">(splash,args)</span></span></span><br><span class="line">    splash:go(<span class="string">'www.baidu.com'</span>)</span><br><span class="line">    splash:runjs(<span class="string">'foo=function()&#123;return "bar"&#125;'</span>)</span><br><span class="line">    splash:evaljs(<span class="string">"foo()"</span>)</span><br><span class="line"></span><br><span class="line">html() 获取网页源代码</span><br><span class="line">get_cookies()</span><br><span class="line">add_cookie()</span><br><span class="line">clear_cookies()</span><br><span class="line">get_viewpoint_size() 获取浏览器可见的大小(宽高)</span><br><span class="line">set_viewpoint_size(<span class="number">100</span>,<span class="number">200</span>) 设置宽高</span><br><span class="line">set_viewpoint_full()全屏显示</span><br><span class="line">set_user_agent()设置浏览器的代理</span><br><span class="line">set_custom_headers()设置请求头</span><br><span class="line"></span><br><span class="line"><span class="built_in">select</span>(选择):send_text(<span class="string">'xxx'</span>)#css选择器</span><br><span class="line">select_all(xx)</span><br><span class="line">send_text(<span class="string">'发送文本'</span>)</span><br><span class="line">:mouse_click()	鼠标点击</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">url = http://localhost:8050/render.html?url=https://www.baidu.com</span><br><span class="line">responsee = requests.get(url)</span><br><span class="line">response.text</span><br><span class="line"></span><br><span class="line">http://localhost:8050/render.html?url=https://www.baidu.com&amp;wait=5  #等待5s</span><br><span class="line">http://localhost:8050/render.png?url=https://www.jd.com&amp;wait=5&amp;width=1000&amp;height=700</span><br><span class="line">http://localhost:8050/render.har?url=xx</span><br><span class="line">http://localhost:8050/render.json?url=xx</span><br><span class="line"></span><br><span class="line">http://localhost:8050/execute?lua_source=xxx  </span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line">lua = <span class="string">'''</span></span><br><span class="line"><span class="string">function main(splash)</span></span><br><span class="line"><span class="string">	return 'hello'</span></span><br><span class="line"><span class="string">end</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line">url = <span class="string">'https://localhost:8050/execute?lua_source='</span>+quote(lua) <span class="comment">#转成计算机能理解的字符</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash,args)</span></span></span><br><span class="line">    <span class="keyword">local</span> treat = <span class="built_in">require</span>(<span class="string">'treat'</span>)</span><br><span class="line">    <span class="keyword">local</span> response = splash:http_get(<span class="string">'https://jd.com'</span>)</span><br><span class="line">    <span class="keyword">return</span>&#123;</span><br><span class="line">        html = treat.as_tring(response.body),</span><br><span class="line">        url = response.url,</span><br><span class="line">        <span class="built_in">status</span> = response.<span class="built_in">status</span></span><br><span class="line">    &#125;<span class="keyword">end</span></span><br></pre></td></tr></table></figure>

<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span><span class="params">(splash)</span></span></span><br><span class="line">    splash:set_custom_headers(&#123;</span><br><span class="line">            [<span class="string">'User-Agent'</span>] = <span class="string">'xx'</span>,</span><br><span class="line">            [<span class="string">'Referer'</span>] = <span class="string">'xxx'</span></span><br><span class="line">        &#125;)</span><br><span class="line">    splash:go(<span class="string">'xx'</span>)</span><br><span class="line">    <span class="keyword">return</span> &#123;splash:html()&#125;<span class="keyword">end</span></span><br></pre></td></tr></table></figure>



<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.keys <span class="keyword">import</span> Keys</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.wait <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditons <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote </span><br><span class="line"></span><br><span class="line">browser = webdriver.Chrome()</span><br><span class="line">wait = WebDriverWait(browser<span class="number">.10</span>)</span><br><span class="line">KEYWORD = <span class="string">'ipad'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index_page</span><span class="params">(page)</span>:</span></span><br><span class="line">    print(<span class="string">f'正在抓取第<span class="subst">&#123;page&#125;</span>页'</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        url = <span class="string">"https://s.taobao.com/search?q="</span>+quote(KEYWORD)</span><br><span class="line">        browser.get(url)</span><br><span class="line">        <span class="keyword">if</span> page &gt; <span class="number">1</span>:</span><br><span class="line">            inp = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'xx'</span>)))</span><br><span class="line">            submit = wait.until(EC.element_to_be_clickable((By.ID,<span class="string">'yy'</span>)))</span><br><span class="line">            inp.clear()</span><br><span class="line">            inp.send_keys(page)</span><br><span class="line">            submit.click()</span><br><span class="line">            wait.until(EC.text_to_be_present_in_element((By.ID,<span class="string">'zz'</span>),str(page)))<span class="comment">#下面数字页面标签</span></span><br><span class="line">            wait.until(EC.presence_of_element_located((By.ID,<span class="string">'aaa'</span>))) <span class="comment">#页面全部加载完的标签</span></span><br><span class="line">            get_products()  <span class="comment">#上面标签都加载出来了就执行这个方法</span></span><br><span class="line">	<span class="keyword">except</span> TimeoutException: </span><br><span class="line">        index_page(page)  <span class="comment">#报错了就重复执行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''geetest验证码,绝对会有一张完整的图片'''</span></span><br><span class="line">position = wait.until(EC.presence_of_element_located((By.XPATH,<span class="string">'//div[@class="geetest_panel'</span>)))</span><br><span class="line"></span><br><span class="line">location = position.location</span><br><span class="line">size = position.size</span><br><span class="line"></span><br><span class="line">top, bottom, left, right = </span><br><span class="line">location[<span class="string">'y'</span>], location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>], location[<span class="string">'x'</span>], location[<span class="string">'x'</span>] + size[<span class="string">'width'</span>]</span><br><span class="line"></span><br><span class="line"><span class="string">'''左上右下'''</span></span><br><span class="line">left = location[<span class="string">'x'</span>]</span><br><span class="line">top = location[<span class="string">'y'</span>]</span><br><span class="line">right = location[<span class="string">'x'</span>] + size[<span class="string">'width'</span>]</span><br><span class="line">bottom = location[<span class="string">'y'</span>] + size[<span class="string">'height'</span>]</span><br><span class="line"></span><br><span class="line">image = Image.open(<span class="string">'bilibili.png'</span>)   <span class="comment">#整张页面的图</span></span><br><span class="line">que = image.crop((left, top, right, bottom)) <span class="comment">#根据整张页面的图片进行裁剪</span></span><br><span class="line">que.save(<span class="string">'gap.png'</span>)</span><br><span class="line"></span><br><span class="line">js =<span class="string">'document.getElementsByClassName("类名")[0].style["display"]="inline"'</span></span><br><span class="line">browser.execute_script(js)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> pytesseract</span><br><span class="line">image = Image.open(<span class="string">'code2.jpg'</span>)</span><br><span class="line">image = image.convert(<span class="string">"L"</span>) <span class="comment">#首先，灰度处理</span></span><br><span class="line">threshold = <span class="number">160</span> <span class="comment">#阈yu值 </span></span><br><span class="line">table = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>): <span class="comment">#其次，灰度上二值化处理</span></span><br><span class="line">    <span class="keyword">if</span> i &lt; threshold:</span><br><span class="line">        table.append(<span class="number">0</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">        table.append(<span class="number">1</span>)</span><br><span class="line">image= image.point(table,<span class="string">'1'</span>) <span class="comment">##point方法很常用</span></span><br><span class="line">image.show()</span><br><span class="line">image.save(<span class="string">'a.png'</span>)</span><br><span class="line">pytesseract.image_to_string(<span class="string">'a.png'</span>,<span class="string">'chi_sim'</span>) <span class="comment">#安装目录存放了语言</span></span><br></pre></td></tr></table></figure>

<h4 id="App爬取"><a href="#App爬取" class="headerlink" title="App爬取"></a>App爬取</h4><h5 id="mitmproxy"><a href="#mitmproxy" class="headerlink" title="mitmproxy"></a>mitmproxy</h5><p><strong>mitm中间人攻击</strong></p>
<ul>
<li>window启动  <code>mitmdump</code>   带界面就输入:mitmweb</li>
<li>输入命令 <code>mitmdump -s a.py</code></li>
<li>保存数据 <code>mitmdump -w 文件</code></li>
<li><code>网址：mitm.it 下载证书</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># a.py</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(flow)</span>:</span>  <span class="comment">#必须是这个函数 flow流量请求，只是多了一个flow</span></span><br><span class="line">	flow.request.headers[<span class="string">'User-Agent'</span>] = <span class="string">"MitmProxy'   #修改请求头</span></span><br><span class="line"><span class="string">    flow.request.url = 'xx' #都是可以改的</span></span><br><span class="line"><span class="string">print(flow.request.headers)</span></span><br><span class="line"><span class="string">print(flow.request.cookies)</span></span><br><span class="line"><span class="string">print(flow.request.method)</span></span><br><span class="line"><span class="string">print(flow.request.port)</span></span><br><span class="line"><span class="string">print(flow.request.scheme)</span></span><br><span class="line"><span class="string">print(flow.request.url)</span></span><br><span class="line"><span class="string">print(flow.request.host)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>日志输出<code>ctx.log</code>  </li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#用ctx.log输出可以显示不同的颜色，而且是有选择的打印</span></span><br><span class="line"><span class="keyword">from</span> mitmproxy <span class="keyword">import</span> ctx</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(flow)</span>:</span></span><br><span class="line">    flow.request.headers[<span class="string">'User-Agent'</span>] = <span class="string">'MitmProxy'</span></span><br><span class="line">    ctx.log.info(str(flow.request.headers))</span><br><span class="line">    ctx.log.warn(str(flow.request.headers))</span><br><span class="line">    ctx.log.info(str(flow.request.url))</span><br><span class="line">    ctx.log.info(str(专门打印输出的))</span><br><span class="line">    flow.request.url = <span class="string">"xxx"</span>  <span class="comment">#修改url</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">request</span><span class="params">(flow)</span>:</span></span><br><span class="line">    response = flow.response</span><br><span class="line">    print(response.text)</span><br><span class="line">    ctx.log.info(str(response.text)) <span class="comment">#和requests一样，只是多了一个flow</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#reponse 响应处理，我们更关心</span></span><br><span class="line"><span class="comment">#只要放视频，就自动下载到本地</span></span><br><span class="line"><span class="comment">#mitmweb和mitmdump只能开一个，会冲突</span></span><br><span class="line"><span class="comment">#mitm.it</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">num = <span class="number">0</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">response</span><span class="params">(flow)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> num</span><br><span class="line">    target_url = <span class="string">'xxx'</span> <span class="comment">#这是一个视频的特征，只需要抓取这个特征</span></span><br><span class="line">    repeat_urls = [] <span class="comment">#以免重复抓取</span></span><br><span class="line">    <span class="comment">#if flow.request.url.startswith(target_url) 也可以这样，只要请求的url是这样的开头</span></span><br><span class="line">    <span class="keyword">if</span> target_url <span class="keyword">in</span> flow.request.url <span class="keyword">and</span> flow.request.url <span class="keyword">not</span> <span class="keyword">in</span> repeat_urls:</span><br><span class="line">        repeat_urls.append(flow.request.url)</span><br><span class="line">        filename = str(num) + <span class="string">'.mp4'</span></span><br><span class="line">        stream = <span class="literal">True</span></span><br><span class="line">        r = requests.get(flow.request.url,stream=<span class="literal">True</span>)</span><br><span class="line">        <span class="keyword">with</span> open(filename,<span class="string">'ab'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(r.content)</span><br><span class="line">            f.flush() <span class="comment">#好习惯</span></span><br><span class="line">            print(filename+<span class="string">"下载完成"</span>)</span><br><span class="line">            num += <span class="number">1</span></span><br><span class="line"><span class="comment"># mitmdump -s 文件.py</span></span><br></pre></td></tr></table></figure>

<h5 id="appium使用"><a href="#appium使用" class="headerlink" title="appium使用"></a>appium使用</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>开启USB调试</span><br><span class="line"><span class="number">2.</span>adb devices -l</span><br><span class="line"><span class="number">3.</span>model:ONEPLUSE_A6  <span class="comment">#就是设备名</span></span><br><span class="line">- platformName：Android</span><br><span class="line">- deviceName:ONEPLUSE_A600 </span><br><span class="line">- appPackage:com.tencent.mm<span class="comment">#apk包名</span></span><br><span class="line">- appActivity:  <span class="comment">#入口activity名,一般以.开头</span></span><br><span class="line">- platformVersion:<span class="number">4.4</span><span class="number">.3</span><span class="comment">#选填安卓版本</span></span><br><span class="line">    <span class="comment">#全都是text类型</span></span><br><span class="line">$ adb shell dumpsys window | findstr mCurrentFocus <span class="comment">#windows输入</span></span><br><span class="line">  mCurrentFocus=Window&#123;bb4a9d8 u0 com.tencent.mm/com.tencent.mm.ui.LauncherUI&#125;</span><br><span class="line">									包名			activity名字</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> appium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support.ui <span class="keyword">import</span> webDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line">server = <span class="string">'http://localhost:4723/wd/hub'</span></span><br><span class="line">desired_caps = &#123;</span><br><span class="line">    <span class="string">'platformName'</span>:<span class="string">'xx'</span>,</span><br><span class="line">    <span class="string">'deviceName'</span>:<span class="string">'xxx'</span></span><br><span class="line">    <span class="string">'appPackage'</span>:<span class="string">'xxx'</span>,</span><br><span class="line">    <span class="string">'appActivity'</span>:<span class="string">'xxx'</span></span><br><span class="line">&#125;</span><br><span class="line">driver = webdriver.Remote(server,desired_caps) </span><br><span class="line">wait = WebDriverWait(driver,<span class="number">30</span>)</span><br><span class="line">username = wait.until(EC.presence_of_element_located((By.ID,<span class="string">'xx'</span>)))</span><br><span class="line">username.set_text(<span class="string">"123"</span>)  <span class="comment">#  send_keys('xxx')一样</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''输入文本：set_text('xx)'''</span> <span class="comment">#有的书用的 send_keys('')</span></span><br><span class="line"></span><br><span class="line"><span class="string">'''屏幕滑动：swipe'''</span></span><br><span class="line">driver.swipe(self,start_x,start_y,end_x,end_y,duration=<span class="literal">None</span>)</span><br><span class="line"></span><br><span class="line"><span class="string">'''屏幕滚动:scroll'''</span> <span class="comment">#不知道有什么用，有的书根本没有提到</span></span><br><span class="line">driver.scroll(self,origin,destination)</span><br><span class="line"></span><br><span class="line"><span class="string">'''拖曳：drag_and_drop'''</span></span><br><span class="line">driver.drag_and_drop(origin,destination)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#朋友圈无限上划，是屏幕开始到结束位置，不是你手指开始到结束位置</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    driver.swipe(<span class="number">300</span>,<span class="number">1000</span>,<span class="number">300</span>,<span class="number">300</span>)  </span><br><span class="line">    </span><br><span class="line">items = wait.until(EC.presence_of_all_elements_located((By.XPATH,<span class="string">'//整张页面的父元素'</span>)))</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> items:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        name = item.find_element_by_id(<span class="string">"id"</span>).get_attribute(<span class="string">"text"</span>)   <span class="comment">###</span></span><br><span class="line">        <span class="comment">##get_attribute()就是selenium中的方法</span></span><br><span class="line">	<span class="keyword">except</span> NosuchElementException:<span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">collection.update(&#123;<span class="string">"name"</span>:name,<span class="string">'age'</span>:age&#125;,&#123;<span class="string">"$set"</span>:data&#125;,<span class="literal">True</span>) <span class="comment">#关键第3个参数，存在更新，不存在则插</span></span><br></pre></td></tr></table></figure>

<p><strong>我看别的书上对于swipe的理解</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''先自定义一个函数，用于获取屏幕的大小'''</span></span><br><span class="line"><span class="string">'''开始x 开始y  结束x 结束y 持续时间'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSize</span><span class="params">()</span>:</span></span><br><span class="line">    x = driver.get_window_size()[<span class="string">'width'</span>] <span class="comment">#获取手机屏幕宽度</span></span><br><span class="line">    y = driver.get_window_size()[<span class="string">'height'</span>] <span class="comment">#获取手机屏幕高度</span></span><br><span class="line">    <span class="keyword">return</span> (x,y)</span><br><span class="line"><span class="comment">#向上滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeUp</span><span class="params">(t)</span>：</span></span><br><span class="line">local = getSize()</span><br><span class="line">x = int(local[<span class="number">0</span>] * <span class="number">0.5</span>)</span><br><span class="line">y1 = int(local[<span class="number">0</span>] * <span class="number">0.75</span>)</span><br><span class="line">y2 = int(local[<span class="number">1</span>] * <span class="number">0.25</span>)</span><br><span class="line">driver.swipe(x,y1,x,y2,t)</span><br><span class="line"><span class="comment">#向下滑动</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeDown</span><span class="params">(t)</span>:</span></span><br><span class="line">    local = getSizze()</span><br><span class="line">    x = int(local[<span class="number">0</span>] * <span class="number">0.5</span>)</span><br><span class="line">    y1 = int(local[<span class="number">1</span>] * <span class="number">0.25</span>)</span><br><span class="line">    y2 = int(local[<span class="number">1</span>] * <span class="number">0.75</span>)</span><br><span class="line">    driver.swipe(x,y1,x,y2,t)</span><br><span class="line"><span class="comment">#向左滑</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeLeft</span><span class="params">(t)</span>:</span></span><br><span class="line">    local = getSize()</span><br><span class="line">    x1 = int(local[<span class="number">0</span>] * <span class="number">0.75</span>)</span><br><span class="line">    y = int(local[<span class="number">1</span>] * <span class="number">0.5</span>)</span><br><span class="line">    x2 = int(local[<span class="number">0</span>] * <span class="number">0.05</span>)</span><br><span class="line">    driver.swipe(x1,y,x2,y,t)</span><br><span class="line"><span class="comment">#向右滑</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">swipeLeft</span><span class="params">(t)</span>:</span></span><br><span class="line">    local = getSize()</span><br><span class="line">    x1 = int(local[<span class="number">0</span>] * <span class="number">0.05</span>)</span><br><span class="line">    y = int(local[<span class="number">1</span>] * <span class="number">0.5</span>)</span><br><span class="line">    x2 = int(local[<span class="number">0</span>] * <span class="number">0.75</span>)</span><br><span class="line">    driver.swipe(x1,y,x2,y,t)</span><br></pre></td></tr></table></figure>

<h4 id="pyspider"><a href="#pyspider" class="headerlink" title="pyspider"></a>pyspider</h4><ul>
<li>可视化编写和调试</li>
<li>支持多种<strong>消息队列</strong></li>
<li>可以 抓取js渲染页面</li>
</ul>
<h4 id="scrapy"><a href="#scrapy" class="headerlink" title="scrapy"></a>scrapy</h4><ul>
<li>Engine,核心。处理整个系统的数据流，触发事务</li>
<li>Item，命名</li>
<li>Scheduler，调度器。接受引擎发过来的请求并加入<strong>队列</strong>，在引擎再次请求的时将请求给引擎</li>
<li>Downloader，下载器。下载网页内容，给蜘蛛</li>
<li>Spiders，分析，提取下载器给的内容，如果解析出有新的请求那就给引擎。没有就交给管道</li>
<li>Item Pipeline。负责把蜘蛛给的数据进行清洗，和存储</li>
<li>Downloader Middlewares。位于下载器和引擎之间。给下载器之前需要进行的一些处理</li>
<li>Spider Middlewares 。引擎和蜘蛛之间。引擎把下载器的数据给蜘蛛之前可以进行的一些处理</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">流程：</span><br><span class="line">	1.引擎打开一个网站，找到该网站的spider，请求爬取的第一个url</span><br><span class="line">	2.把请求到url给调度器，调度器放在队列保存。</span><br><span class="line">	3.引擎向调度器要url，url经过下载中间件处理后给下载器</span><br><span class="line">	4.下载器处理后生成response。并又经过下载中间件给引擎。</span><br><span class="line">	5.引擎收到response后通过蜘蛛中间件处理后给蜘蛛</span><br><span class="line">	5.蜘蛛得到response解析。如果解析出有心得request则又通过蜘蛛中间件给引擎，引擎再给调度器。没有新的请求则把解析的数据交给管道</span><br><span class="line">	6.调度器中没有request了，引擎关闭网站。爬虫结束</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">创建项目： </span><br><span class="line">	scrapy startproject xx项目(文件夹)</span><br><span class="line">	cd xx项目(文件夹)</span><br><span class="line">	scrapy genspider spider名 www.xx域名</span><br><span class="line">	scrapy genspider -t crawl spider名 www.域名 # template的t是模板的意思</span><br><span class="line">	scrapy crawl spider名</span><br><span class="line">	scrapy crawl spider名 -o xx.json</span><br><span class="line">	scrapy runspider spider名.py</span><br><span class="line">	scrapy genspider -l #查看模板列表</span><br><span class="line">	scrapy genspider -d crawl  # demo样式</span><br><span class="line">	通过脚本执行：</span><br><span class="line">		在项目中添加一个文件：start.py</span><br><span class="line">			from scrapy import cmdline</span><br><span class="line">			cmdline.execute(&#39;scrapy crawl xx&#39;.split())</span><br><span class="line">COOKIES_ENABLED &#x3D; False #不是特殊需要，就禁用cookies</span><br></pre></td></tr></table></figure>
<p><code>::text 提取文本</code>  <code>::attr(src)</code> <code>yield scrapy.Request()</code>  <code>extract)first(&quot;xxx&quot;)表示匹配不到就返回里面的</code></p>
<ul>
<li>管道  <code>from_crawler(cls,crawler)</code></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#必须返回item或者DropItme()异常</span></span><br><span class="line"><span class="keyword">from</span> scrapy.exceptions <span class="keyword">import</span> DropItem</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MongoPipeline</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self.mongo_uri,mongo_db)</span>:</span></span><br><span class="line">        self.mongo_uri = mongo_uri</span><br><span class="line">        self.mongo_db = mongo_db</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls,crawler)</span>:</span> <span class="comment">#通过crawler可以拿到setting中的变量，er开头的是人，相当于是一个人</span></span><br><span class="line">        <span class="keyword">return</span> cls(mongo_uri = crawler.setting.get(<span class="string">"MONGO_URI"</span>),</span><br><span class="line">                  mogo_db = craler.setting.get(<span class="string">"MONGO_DB"</span>))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">open_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self,item.spider)</span>:</span> <span class="comment"># 记得要返回item或者抛DropItem()异常</span></span><br><span class="line">        <span class="keyword">return</span> item </span><br><span class="line">    	<span class="keyword">return</span> DropItem(<span class="string">"ddd"</span>)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">close_spider</span><span class="params">(self,spider)</span>:</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>要求：在实例a节点中有Name:My image 1,我只想要Name后面的内容</p>
<p>response.xpath(‘//a/text()’).re(“Name:\s(.*)”)</p>
</blockquote>
<p><code>xpath可以嵌套正则，正则也可以像extract_first()一样，有re_first(&#39;表达式&#39;)</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">start_requests()方法说明：</span><br><span class="line">	1.start_requests()默认实现</span><br><span class="line">	2.用于生成初始请求，它必须返回一个可迭代对象</span><br><span class="line">	3.没有重写start_requests()方法默认使用start_urls里的网址构造Request请求</span><br><span class="line">	4.要想发POST请求，改成FormRequst</span><br></pre></td></tr></table></figure>

<h5 id="Downloader-Middleware"><a href="#Downloader-Middleware" class="headerlink" title="Downloader Middleware"></a>Downloader Middleware</h5><blockquote>
<p>引擎从调度器里面拿到请求给下载器之前，经过下载中间件。下载器解析成响应后返给引擎也要经过<br>修改User-Agent、处理重定向、设置代理、失败重试、设置Cookies等</p>
</blockquote>
<ul>
<li>process_request(request,spider)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">1、从调度器里面拿到的请求给下载器之前首先调用的就是这个方法</span><br><span class="line">2、返回值必须是None,Response,Request,IgnoreRequest异常.4者之一</span><br><span class="line">None:</span><br><span class="line">	下面低级的这个函数会去处理。直到返回Response。</span><br><span class="line">Response:√</span><br><span class="line">	得到的响应交给process_response()。</span><br><span class="line">Request:</span><br><span class="line">	会重新放到调度器里，变成全新的请求。</span><br><span class="line">IgnoreRequest:</span><br><span class="line">	process_exception()会执行。解决不了则被忽略。</span><br></pre></td></tr></table></figure>

<ul>
<li>process_response(request,response,spider)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">返回值：Request</span><br><span class="line">	重新放到调度器这中</span><br><span class="line">返回值：Response</span><br><span class="line">	给引擎，引擎给蜘蛛  ,【【【虫术里面说给低级的这个函数处理或引擎】】】</span><br><span class="line">返回值：IgnoreRequest</span><br><span class="line">	会有人处理，处理不掉就忽略</span><br></pre></td></tr></table></figure>

<ul>
<li>process_exception(request,exception,spider)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">上面抛出异常时候被调用</span><br><span class="line">返回值必须是None,Response,Request之一</span><br><span class="line">None:</span><br><span class="line">	下面更低级的这个方法调用，直到处理掉</span><br><span class="line">Request:</span><br><span class="line">	给调度器</span><br><span class="line">Response:</span><br><span class="line">	给process_response()方法去执行</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">更改USER_AGENT的两种方式：</span><br><span class="line">	1、在setting中定义一个：USER_AGENT</span><br><span class="line">	2、在process_request(request,spider)#书上什么包都没导入，直接搞列表</span><br><span class="line">	request.headers[&#39;User-Agent&#39;] &#x3D; random.choice(xxx)</span><br><span class="line"></span><br><span class="line">更改代理：</span><br><span class="line">	搞一个代理池</span><br><span class="line">	用request.url.split(&#39;&#x2F;&#39;) &#x3D;&#x3D; &#39;https&#39;这样判断是什么协议</span><br><span class="line">	在process_request(request,spider)中定义request.meta[&#39;proxy&#39;] &#x3D; random.choice(xxx)</span><br><span class="line">	</span><br><span class="line">在process_response(request,response,spider)中修改状态码：</span><br><span class="line">	response.status &#x3D; 201</span><br><span class="line">	return response</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_exception</span><span class="params">(self,request,exception,spider)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> request.url.split(<span class="string">':'</span>)[<span class="number">0</span>] == <span class="string">'http'</span>:</span><br><span class="line">        request.meta[<span class="string">'proxy'</span>] = <span class="string">'http://'</span> + random.choice(proxy_http) </span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">		...</span><br><span class="line">	<span class="keyword">return</span> request <span class="comment">#修正后重新发给request处理</span></span><br></pre></td></tr></table></figure>

<h5 id="Pipelines"><a href="#Pipelines" class="headerlink" title="Pipelines"></a>Pipelines</h5><ul>
<li>process_item(item,spider)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>、必须返回Item或者DropItem</span><br><span class="line"><span class="number">2</span>、返回Item会交给下面的管道处理，异常则丢弃</span><br><span class="line"><span class="string">'''在管道中可以定义集合:collection = table = 'mingzi'，这相当于把名字归类了</span></span><br><span class="line"><span class="string">然后在item，，process_item中用self.db[item.collection].insert(dict(item))'''</span></span><br></pre></td></tr></table></figure>

<ul>
<li>open_spider(self,spider)</li>
<li>close_spider(self,pider)</li>
<li>from_crawler(cls,crawler)</li>
</ul>
<h5 id="图片存储"><a href="#图片存储" class="headerlink" title="图片存储"></a>图片存储</h5><p><code>是异步的</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MysqlPipeline</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,host,database,user,password,port)</span>:</span></span><br><span class="line">        self.host = host</span><br><span class="line">        self.user = user</span><br><span class="line">        self.databse = database</span><br><span class="line">        self.password = password</span><br><span class="line">        self.port = port</span><br><span class="line"><span class="meta">	@classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">from_crawler</span><span class="params">(cls,crawler)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> cls(</span><br><span class="line">        host = crawler.setting.get(<span class="string">'MYSQL_HOST'</span>),</span><br><span class="line">        database = crawler.setting.get(<span class="string">"MYSQL_DATABASE"</span>),</span><br><span class="line">        user = crawler.setting.get(<span class="string">"MYSQL_PASSWORD"</span>),</span><br><span class="line">        port = crawler.setting.get(<span class="string">"MYSQL_PORT"</span>))</span><br><span class="line">    </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">oprn_spider</span><span class="params">(self,spider)</span>:</span></span><br><span class="line">        self.db = pymysql.connect(self.host,</span><br><span class="line">                                  self.user,</span><br><span class="line">                                  self.password,</span><br><span class="line">                                  self.database,</span><br><span class="line">                                  charset=<span class="string">'utf-8'</span>,</span><br><span class="line">                                  self.port=port)</span><br><span class="line">        self.cursor = self.db.cursor()</span><br><span class="line">        </span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">process_item</span><span class="params">(self,item,spider)</span>:</span></span><br><span class="line">        data = dict(item)</span><br><span class="line">        keys = <span class="string">","</span>.join(data.keys())</span><br><span class="line">        values = <span class="string">','</span>.join([<span class="string">'%s'</span>]*len(data))</span><br><span class="line">        sql = <span class="string">f'insert into <span class="subst">&#123;item.table&#125;</span>(<span class="subst">&#123;keys&#125;</span>) values (<span class="subst">&#123;values&#125;</span>)'</span> <span class="comment">#这里的item.table是Item那边的</span></span><br><span class="line">        self.cursor.execute(sql,tuple(data.values()))</span><br><span class="line">        self.db.commit()</span><br><span class="line">        <span class="keyword">return</span> item</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#在setting中定义一个: IMAGES_STORE = './images'</span></span><br><span class="line"><span class="keyword">import</span> scrapy</span><br><span class="line"><span class="keyword">from</span> scrapy.exceptions <span class="keyword">import</span> DropItem</span><br><span class="line"><span class="keyword">from</span> scrapy.pipelines.images <span class="keyword">import</span> ImagesPipeline</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ImagePipeline</span><span class="params">(ImagesPipeline)</span>:</span> <span class="comment">#继承它</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">file_path</span><span class="params">(self,request,response,info=None)</span>:</span>   <span class="comment">#下面可以储存，那这个岂不是没用了</span></span><br><span class="line">        url = request.url</span><br><span class="line">        file_name = url.split(<span class="string">'/'</span>)[<span class="number">-1</span>]</span><br><span class="line">        <span class="keyword">return</span> file_name</span><br><span class="line">    <span class="string">'''下面这种方法是另一本书的，我觉得很可取</span></span><br><span class="line"><span class="string">    书上导入了setting：from scrapy.conf import setting</span></span><br><span class="line"><span class="string">    	file_name = settings['FILES_STORE'] + (request.meta['name'])</span></span><br><span class="line"><span class="string">    	return file_name #以前我想怎么拿到meta的数据，原来通过request就可以</span></span><br><span class="line"><span class="string">    '''</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">item_completed</span><span class="params">(self,results,item,info)</span>:</span></span><br><span class="line">        images_paths = [x[<span class="string">'path'</span>] <span class="keyword">for</span> ok,x <span class="keyword">in</span> result <span class="keyword">if</span> ok]</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> images_paths:</span><br><span class="line">            <span class="keyword">raise</span> DropItem(<span class="string">'Image Downloaded Failed'</span>)</span><br><span class="line">		<span class="keyword">return</span> item</span><br><span class="line">    	<span class="comment">#####-----下面是另一本书上面的，可以改文件名-----###</span></span><br><span class="line">        image_path = [x[<span class="string">'path'</span>] <span class="keyword">for</span> ok,x <span class="keyword">in</span> result <span class="keyword">if</span> ok]</span><br><span class="line">        os.rename(self.IMAGES_STORE+<span class="string">'/'</span>+image_path[<span class="number">0</span>],self.IMAGES_STORE+<span class="string">'/'</span>+item[<span class="string">'a'</span>]+<span class="string">'.jpg'</span>)</span><br><span class="line">        item[<span class="string">'image_path'</span>] = self.IMAGES_STORE+<span class="string">'/'</span>+item[<span class="string">'a'</span>]</span><br><span class="line">        <span class="keyword">return</span> item</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_media_requests</span><span class="params">(self,imte,info)</span>:</span> <span class="comment">#########获取媒体请求</span></span><br><span class="line">        <span class="keyword">yield</span> scrapy.Request(item[<span class="string">'url'</span>]) <span class="comment">#所有的请求都是给重新给调度器了</span></span><br></pre></td></tr></table></figure>

<h5 id="对接selenium"><a href="#对接selenium" class="headerlink" title="对接selenium"></a>对接selenium</h5><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">在spider中定重写start_requests(self)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">start_requests</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> keyword <span class="keyword">in</span> self.settings.get(<span class="string">'KEYWORDS'</span>):</span><br><span class="line">        <span class="keyword">for</span> page <span class="keyword">in</span> range(<span class="number">1</span>,self.settings.get(<span class="string">'MAX_PAGE'</span>)+<span class="number">1</span>): <span class="comment">#通过self.setting</span></span><br><span class="line">            url = self.base_url + quote(keyword)  </span><br><span class="line">            <span class="keyword">yield</span> scrapy.Request(url=url,callback=self.parse,meta=&#123;<span class="string">'page'</span>:page&#125;)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">'''这个类中间件可以自己完全的重写一个，也可以在已有的基础上上添加'''</span></span><br><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver</span><br><span class="line"><span class="keyword">from</span> selenium.common.exceptions <span class="keyword">import</span> TimeoutException</span><br><span class="line"><span class="keyword">from</span> selenium.webdrive.common.by <span class="keyword">import</span> By</span><br><span class="line"><span class="keyword">from</span> selenium.webdrive.support.waite <span class="keyword">import</span> WebDriverWait</span><br><span class="line"><span class="keyword">from</span> selenium.webdriver.support <span class="keyword">import</span> expected_conditions <span class="keyword">as</span> EC</span><br><span class="line"><span class="keyword">from</span> scrapy.http <span class="keyword">import</span> HtmlResponse</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> getLogger</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">xxMiddleware</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,timeout=None)</span>:</span></span><br><span class="line">        self.logger = getLogger(__name__)</span><br><span class="line">        self.timeout = timeout</span><br><span class="line">        self.browser = webdriver.Chrome()</span><br><span class="line">        self.browser.maximize_window()</span><br><span class="line">        self.wait = WebDriverWait(self.browser,self.timeout)</span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span><span class="comment">##################__del__ 是GC回收方法</span></span><br><span class="line">        self.browser.close()  <span class="comment">#############作者直接在类里面关的，而视频在爬虫文件里面用closed关的</span></span><br><span class="line">	<span class="function"><span class="keyword">def</span> <span class="title">process_request</span><span class="params">(self,request,spider)</span>:</span> <span class="comment">#*********视频是在response里面</span></span><br><span class="line">        self.logger.debug(<span class="string">"浏览器开始"</span>)</span><br><span class="line">        page = request.meta.get(<span class="string">'page'</span>)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            self.browser.get(request.url)</span><br><span class="line">            <span class="keyword">if</span> page &gt; <span class="number">1</span>:</span><br><span class="line">                inp = self.wait.until(EC.presence_of_element_located((By.XPath,<span class="string">'xx'</span>)))</span><br><span class="line">                submit = self.wait.until(EC.element_to_be_clickable((By.XPATH,<span class="string">'x'</span>)))</span><br><span class="line">                inp.clear()</span><br><span class="line">                inp.send_keys(<span class="string">"xx"</span>)</span><br><span class="line">                submit.click()</span><br><span class="line">                self.wait.until(EC.text_to_be_present_in_element((By.XPATH,<span class="string">'xx'</span>),str(page)))</span><br><span class="line">                <span class="keyword">return</span> HtmlResponse(url=request.url,body=self.browser.page_source,request=requests,encoding=<span class="string">'utf-8'</span>,status=<span class="number">200</span>) </span><br><span class="line">		<span class="keyword">except</span> TimeoutException:</span><br><span class="line">            <span class="keyword">return</span> HtmlResponse(url=request.url,status=<span class="number">500</span>,request=request)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">看视频，是在response里面处理的，相当于拿到请求的url后处理的数据</span><br><span class="line">而书上是直接完全把请求改变了。</span><br><span class="line">要明白spider 就是主文件的spider类</span><br><span class="line">书上面重新定义了一个类，视频是在原来基础上写的。但是最后都要开启</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">process_response</span><span class="params">(self,request,response,spider)</span>:</span></span><br><span class="line">    bro = spider.bro</span><br><span class="line">    <span class="keyword">if</span> request.url <span class="keyword">in</span> spider.five_urls:</span><br><span class="line">        bro.get(request.url)</span><br><span class="line">        ...</span><br><span class="line">        <span class="keyword">return</span> HtmlResponse(url=request.url,body=self.bro.page_source,request=request)</span><br><span class="line">    最后关的方式也不是一样的，视频是在主文件里面用</span><br><span class="line">    书上是用的__del__</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">closed</span><span class="params">(self,spider)</span>:</span> </span><br><span class="line">        self.bro.close()关的</span><br></pre></td></tr></table></figure>

<h4 id="scrapy-splash"><a href="#scrapy-splash" class="headerlink" title="scrapy_splash"></a>scrapy_splash</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">http://github.com/scrapy-plugins/scrapy-splash<span class="comment">#configuration  #官方配置说明</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#注册scrapy_splash的中间件</span></span><br><span class="line">SPIDER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">'scrapy_splash.SplashDeduplicateArgsMiddleware'</span>:<span class="number">10</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#注册scrapy_splash和scrapy内置的中间件</span></span><br><span class="line">DOWNLOADER_MIDDLEWARES = &#123;</span><br><span class="line">    <span class="string">'scrapy_splash.SplashCookiesMiddleware'</span>:<span class="number">723</span>,</span><br><span class="line">    <span class="string">'scrapy_splash.SplashMiddleware'</span>:<span class="number">725</span>,</span><br><span class="line">    <span class="string">'scrapy.downloadermiddlewares.httpcompression.HttpCompressionMiddleware'</span>:<span class="number">810</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">#设置scrapy_splash配置属性</span></span><br><span class="line">SPLASH_URL = <span class="string">'http://192.168.31.42:8050/'</span></span><br><span class="line"><span class="comment">#去重过滤器</span></span><br><span class="line">DUPEFILTER_CLASS = <span class="string">'scrapy_splash.SplashAwareDupeFilter'</span></span><br><span class="line"><span class="comment">#自定义HTTP缓存机制</span></span><br><span class="line">HTTPCACHE_STORAGE = <span class="string">'scrapy_splash.SplashAwareFSCacheStorage'</span></span><br><span class="line"><span class="comment">#设置cookies记录所有请求的发送和接受cookies</span></span><br><span class="line">SPLASH_COOKIES_DEBUG = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> scrapy_splash <span class="keyword">import</span> SplashRequest <span class="comment">#其它都一样</span></span><br><span class="line"></span><br><span class="line">function main(splash,args)</span><br><span class="line">	splash.image_enabled = false</span><br><span class="line">    <span class="keyword">assert</span>(splash:go(args.url))</span><br><span class="line">    <span class="keyword">assert</span>(splash:wait(args.wait))</span><br><span class="line">end</span><br><span class="line">url = <span class="string">'xx'</span></span><br><span class="line">args = &#123;lua_source=script,<span class="string">'wait'</span>:<span class="string">'3'</span>,<span class="string">"headers"</span>:xx&#125; <span class="comment">#这是定义splash的参数</span></span><br><span class="line">最后 <span class="keyword">yield</span> SplashRequets(url,self.parse,endpoint=<span class="string">'execute'</span>,args=args)</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  


          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Qinggui</p>
              <p class="site-description motion-element" itemprop="description">庆归的博客，主要用来记笔记，分享心得</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/%20%7C%7C%20archive">
              
                  <span class="site-state-item-count">1</span>
                  <span class="site-state-item-name">posts</span>
                </a>
              </div>
            

            

            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Qinggui</span>

  
</div>


  <div class="powered-by">Powered by <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  

  

  

</body>
</html>
